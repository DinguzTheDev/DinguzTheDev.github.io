<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kierunek: Mateusz</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #12001f 10%, #240b36 100%);
            height: 100vh;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: background 3s ease-out;
        }

        body.final-state {
            background: #000000;
        }

        /* --- UI --- */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 200;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            flex-direction: column;
        }
        #start-overlay h1 {
            border: 2px solid #d600ff; padding: 20px; border-radius: 10px; 
            background: rgba(255,255,255,0.05); color: #d600ff;
            text-shadow: 0 0 10px #d600ff; text-align: center;
        }

        #white-flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 150; opacity: 0; pointer-events: none;
            transition: opacity 3s ease-out;
        }

        #countdown-container {
            z-index: 100; text-align: center;
        }
        #countdown {
            font-size: 3rem; 
            text-shadow: 0 0 20px #fff, 0 0 30px #9d00ff;
        }
        #trip-title {
            font-size: 1.5rem; color: #ccc; margin-bottom: 20px; letter-spacing: 2px;
        }

        /* --- WIDEO KONTENER --- */
        #video-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            justify-content: space-around; 
            align-items: center; 
            z-index: 60;
            pointer-events: none;
            display: none; 
            padding: 0 2%; 
            box-sizing: border-box;
        }

        .beat-video {
            width: 30%; 
            height: auto;
            max-height: 85vh; 
            object-fit: contain;
            
            /* T≈Ço MP4 staje siƒô przezroczyste (musi byƒá czarne w pliku) */
            mix-blend-mode: screen; 
            
            /* Usuniƒôty transition dla ostrych uderze≈Ñ */
            transform-origin: center center;
            will-change: transform;
        }

        /* --- WATERMARK --- */
        #watermark {
            position: fixed; bottom: 15px; right: 15px;
            color: rgba(255, 255, 255, 0.4); 
            font-size: 0.7rem; z-index: 300; pointer-events: none; font-family: sans-serif;
            text-transform: uppercase; letter-spacing: 1px;
        }

        /* --- T≈ÅO --- */
        .snow, .star-bg {
            position: absolute; top: -10px; border-radius: 50%; pointer-events: none;
        }
        .snow { background: white; opacity: 0.6; animation: fall linear infinite; }
        .star-bg { background: rgb(200, 230, 255); animation: twinkle 2s infinite ease-in-out; }

        @keyframes fall { to { transform: translateY(105vh); } }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(0.5); } 50% { opacity: 1; transform: scale(1.2); } }

        /* Canvas */
        #mainCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50;
        }
    </style>
</head>
<body>

    <div id="watermark">made by .dinguzthedev</div>

    <div id="start-overlay" onclick="startExperience()">
        <h1>ODPAL PROTOK√ì≈Å: MATEUSZ üöÄ</h1>
        <p style="color: #888; margin-top: 10px;">(kliknij ekran)</p>
    </div>

    <div id="white-flash"></div>

    <div id="countdown-container">
        <div id="trip-title">CZAS DO WYJAZDU:</div>
        <div id="countdown">≈Åadowanie...</div>
    </div>
    
    <div id="video-container">
        <video class="beat-video" id="vid1" src="video1.mp4" loop muted playsinline></video>
        <video class="beat-video" id="vid2" src="video2.mp4" loop muted playsinline></video>
        <video class="beat-video" id="vid3" src="video3.mp4" loop muted playsinline></video>
    </div>

    <canvas id="mainCanvas"></canvas>

    <audio id="musicMain" src="erotycznaprzygoda.mp3" preload="auto" crossorigin="anonymous"></audio>
    <audio id="musicBoom" src="boom.mp3" preload="auto"></audio>

<script>
    // ==========================================
    // ‚öôÔ∏è KONFIGURACJA
    // ==========================================
    
    // DEBUG: 10 sekund
    let targetDateStr = "2025-12-27T00:00:00"
    // DOCELOWO (odkomentuj):
    // let targetDateStr = "2025-12-27T00:00:00"; 

    // ==========================================

    const countdownEl = document.getElementById('countdown');
    const countdownContainer = document.getElementById('countdown-container');
    const whiteFlashEl = document.getElementById('white-flash');
    const videoContainer = document.getElementById('video-container');
    const videos = document.querySelectorAll('.beat-video');
    
    const musicMain = document.getElementById('musicMain');
    const musicBoom = document.getElementById('musicBoom');
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let countdownInterval;
    let isFinalState = false;
    
    // Audio API vars
    let audioCtx, analyser, dataArray, bufferLength, mediaSource;
    let shootingStars = [];

    // Zmienne do wykrywania problem√≥w z d≈∫wiƒôkiem (Auto-Bit)
    let zeroDataCount = 0;
    let forceSimulation = false;

    function startExperience() {
        document.getElementById('start-overlay').style.display = 'none';
        initAudioContext();
        
        musicBoom.play().then(() => { musicBoom.pause(); musicBoom.currentTime = 0; }).catch(()=>{});
        
        videos.forEach(v => {
            v.play().then(() => { v.pause(); v.currentTime = 0; }).catch(()=>{});
        });

        createBackgroundElements(); 
        startTimer();
    }

    function initAudioContext() {
        // Tworzymy kontekst
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        audioCtx = new AudioContext();
        analyser = audioCtx.createAnalyser();
        
        // Podpinamy ≈∫r√≥d≈Ço
        mediaSource = audioCtx.createMediaElementSource(musicMain);
        mediaSource.connect(analyser);
        analyser.connect(audioCtx.destination);

        analyser.fftSize = 256; 
        bufferLength = analyser.frequencyBinCount; 
        dataArray = new Uint8Array(bufferLength); 
    }

    function startTimer() {
        const targetDate = new Date(targetDateStr).getTime();
        countdownInterval = setInterval(() => {
            const now = new Date().getTime();
            const distance = targetDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            countdownEl.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;

            if (distance < 0) {
                clearInterval(countdownInterval);
                countdownEl.innerHTML = "00:00:00";
                triggerSequence();
            }
        }, 1000);
    }

    function triggerSequence() {
        countdownContainer.style.display = 'none'; 
        whiteFlashEl.style.opacity = 1; 
        document.body.classList.add('final-state');
        musicBoom.play();
        
        void whiteFlashEl.offsetWidth; 
        whiteFlashEl.style.opacity = 0;

        setTimeout(() => {
            whiteFlashEl.style.display = 'none'; 
            videoContainer.style.display = 'flex';
            videos.forEach(v => v.play());

            // Upewnij siƒô, ≈ºe AudioContext dzia≈Ça
            if (audioCtx.state === 'suspended') { audioCtx.resume(); }
            musicMain.play(); 
            isFinalState = true; 
            animateFinalScene(); 
        }, 3000); 
    }

    // --- PƒòTLA ANIMACJI ---
    function animateFinalScene() {
        if (!isFinalState) return;
        requestAnimationFrame(animateFinalScene);

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. Analiza Basu
        analyser.getByteFrequencyData(dataArray);
        
        let bassSum = 0;
        // Sprawdzamy zakres bas√≥w (0-20)
        for(let i = 0; i < 20; i++) {
            bassSum += dataArray[i];
        }
        let bassAverage = bassSum / 20;

        // --- SYSTEM AWARYJNY (AUTO-BIT) ---
        // Je≈õli bas wynosi 0 przez d≈Çu≈ºszy czas (np. z powodu blokady przeglƒÖdarki),
        // w≈ÇƒÖczamy symulacjƒô, ≈ºeby u≈ºytkownik widzia≈Ç efekt.
        if (bassAverage === 0) {
            zeroDataCount++;
            if (zeroDataCount > 50) { // Po 50 klatkach ciszy w≈ÇƒÖcz symulacjƒô
                forceSimulation = true;
            }
        } else {
            zeroDataCount = 0;
            forceSimulation = false;
        }

        if (forceSimulation) {
            // Generuj sztuczny bit (puls sinusoidalny szybki)
            // Zwraca warto≈õƒá 0-255 symulujƒÖcƒÖ muzykƒô
            const time = Date.now();
            // Puls co ok. 500ms
            const beat = (Math.sin(time / 80) + 1) * 100; 
            bassAverage = beat;
        }
        // ----------------------------------

        updateShootingStars();
        pulseVideos(bassAverage);
    }

    function pulseVideos(volume) {
        // volume: 0-255
        // Zwiƒôkszona czu≈Ço≈õƒá: nawet ma≈Çy bas (50) da widoczny efekt
        let scaleBoost = (volume / 255) * 0.5; // Max powiƒôkszenie 1.5x
        
        // Dodaj minimalny pr√≥g, ≈ºeby nie drga≈Ço przy ciszy
        if (scaleBoost < 0.05) scaleBoost = 0;

        const scale = 1 + scaleBoost;
        
        videos.forEach(v => {
            v.style.transform = `scale(${scale})`;
        });
    }

    // --- GWIAZDY ---
    function updateShootingStars() {
        if (Math.random() < 0.02) { 
            createShootingStar();
        }

        shootingStars.forEach((star, index) => {
            star.x += star.vx;
            star.y += star.vy;
            const tailX = star.x - star.vx * star.tailLength;
            const tailY = star.y - star.vy * star.tailLength;
            const gradient = ctx.createLinearGradient(star.x, star.y, tailX, tailY);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.beginPath();
            ctx.moveTo(star.x, star.y);
            ctx.lineTo(tailX, tailY);
            ctx.strokeStyle = gradient;
            ctx.lineWidth = star.width;
            ctx.lineCap = 'round';
            ctx.stroke();
            if (star.y > canvas.height + 200 || star.x > canvas.width + 200) {
                shootingStars.splice(index, 1);
            }
        });
    }

    function createShootingStar() {
        const startX = Math.random() * (canvas.width * 1.5) - (canvas.width * 0.5);
        const startY = -Math.random() * 100; 
        const speed = Math.random() * 5 + 4; 
        const angle = (Math.random() * 15 + 30) * (Math.PI / 180);
        shootingStars.push({
            x: startX, y: startY,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            width: Math.random() * 3 + 1, 
            tailLength: Math.random() * 25 + 15 
        });
    }

    // --- T≈ÅO ---
    function createBackgroundElements() {
        const body = document.body;
        for(let i=0; i<60; i++) {
            const star = document.createElement('div');
            star.className = 'star-bg';
            star.style.left = Math.random() * 100 + 'vw';
            star.style.top = Math.random() * 100 + 'vh';
            star.style.width = Math.random() * 3 + 'px';
            star.style.height = star.style.width;
            star.style.animationDuration = (Math.random() * 2 + 0.5) + 's';
            body.appendChild(star);
        }
        for(let i=0; i<50; i++) {
            const snow = document.createElement('div');
            snow.className = 'snow';
            snow.style.left = Math.random() * 100 + 'vw';
            snow.style.width = Math.random() * 4 + 1 + 'px';
            snow.style.height = snow.style.width;
            snow.style.animationDuration = (Math.random() * 5 + 3) + 's';
            snow.style.animationDelay = Math.random() * 5 + 's';
            body.appendChild(snow);
        }
    }

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

</script>
</body>
</html>
