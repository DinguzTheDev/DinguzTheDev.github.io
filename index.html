<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINGUZ CASINO | MOON</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* --- GLOBAL & RESET --- */
        * { box-sizing: border-box; }

        :root {
            --bg-main: #050510;
            --bg-panel: #0f0f1f;
            --moon-primary: #7d5fff;
            --moon-secondary: #4facfe;
            --text-main: #fff;
            --text-dim: #8892b0;
            --success: #00f260;
            --danger: #f53b57;
            --glass-border: 1px solid rgba(125, 95, 255, 0.2);
            --glow: 0 0 20px rgba(125, 95, 255, 0.4);
        }

        body {
            background: radial-gradient(circle at 50% -20%, #1a1a40 0%, var(--bg-main) 80%);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- CONFETTI CANVAS FIX --- */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none; /* Myszka klika "przez" canvas */
            z-index: 9999;
            background: transparent;
        }

        /* --- HEADER --- */
        header {
            width: 100%;
            padding: 15px 5%;
            background: rgba(15, 15, 31, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: var(--glass-border);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        h1 {
            margin: 0;
            font-size: 1.8rem;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
            background: linear-gradient(to right, #fff, #7d5fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            white-space: nowrap;
        }

        .header-right { display: flex; gap: 10px; align-items: center; }

        .balance-box {
            background: linear-gradient(90deg, rgba(125,95,255,0.1), transparent);
            padding: 8px 15px;
            border-radius: 4px;
            border-left: 3px solid var(--moon-primary);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--moon-secondary);
            text-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
            white-space: nowrap;
        }

        button.nav-action-btn {
            background: transparent;
            border: 1px solid var(--moon-primary);
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.3s;
            font-size: 0.75rem;
            white-space: nowrap;
        }
        button.nav-action-btn:hover { background: var(--moon-primary); box-shadow: var(--glow); }

        /* --- NAVIGATION --- */
        .nav-games {
            margin: 30px 20px;
            display: flex;
            gap: 8px;
            padding: 8px;
            background: var(--bg-panel);
            border-radius: 8px;
            border: var(--glass-border);
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-dim);
            padding: 10px 20px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 1rem;
            transition: 0.3s;
            text-transform: uppercase;
            border-radius: 4px;
        }

        .nav-btn.active {
            color: var(--text-main);
            background: rgba(125, 95, 255, 0.1);
            border: 1px solid var(--moon-primary);
            text-shadow: 0 0 10px var(--moon-primary);
        }

        /* --- GAME CONTAINER --- */
        .game-container {
            background: var(--bg-panel);
            width: 95%;
            max-width: 850px;
            padding: 30px;
            border-radius: 12px;
            border: var(--glass-border);
            box-shadow: 0 20px 50px rgba(0,0,0,0.7);
            position: relative;
            min-height: 450px;
            display: flex;
            flex-direction: column;
            margin-bottom: 40px;
        }

        .controls-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            align-items: flex-end;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            flex-wrap: wrap;
        }

        .control-group { flex: 1; min-width: 150px; display: flex; flex-direction: column; gap: 8px; }

        label { color: var(--text-dim); font-size: 0.8rem; font-weight: 600; letter-spacing: 1px; }

        input[type="number"], input[type="text"], input[type="password"] {
            background: #050510;
            border: 1px solid #333;
            color: white;
            padding: 12px 15px;
            font-family: inherit;
            font-size: 1.1rem;
            width: 100%;
            border-radius: 6px;
            transition: 0.2s;
        }
        input:focus { border-color: var(--moon-primary); outline: none; box-shadow: 0 0 10px rgba(125,95,255,0.2); }

        /* --- ACTION BUTTONS --- */
        button.action-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--moon-primary), var(--moon-secondary));
            border: none;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            text-transform: uppercase;
            border-radius: 6px;
            transition: 0.2s;
            margin-top: auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        button.action-btn:hover:not(:disabled) { transform: translateY(-2px); filter: brightness(1.1); }
        button.action-btn:disabled { background: #222; color: #555; cursor: not-allowed; box-shadow: none; transform: none; }
        
        button.cashout-btn { background: var(--success); color: #000; }
        button.put-btn { background: var(--danger); color: #fff; }

        #game-area { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; padding: 20px 0; }

        /* --- FAUCET --- */
        .faucet-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(15,15,31,0.95);
            border: var(--glass-border);
            padding: 20px;
            border-radius: 8px;
            z-index: 90;
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 220px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .faucet-btn {
            background: var(--moon-secondary);
            border: none;
            color: #000;
            padding: 10px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            width: 100%;
        }
        .faucet-btn:disabled { background: #333; color: #555; cursor: default; }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: var(--bg-panel);
            width: 100%;
            max-width: 700px;
            border: var(--glass-border);
            border-radius: 12px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 0 50px rgba(125,95,255,0.3);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        .close-modal { position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 2rem; cursor: pointer; line-height: 1; }
        .modal-title { font-size: 1.5rem; color: var(--moon-primary); font-weight: 700; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 15px; }

        /* SHOP TABS & GRID */
        .shop-tabs { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .shop-tab { flex: 1; padding: 12px; background: #1a1a2e; border: 1px solid #333; color: #888; cursor: pointer; border-radius: 6px; transition: 0.2s; font-weight: bold; text-align: center; white-space: nowrap; }
        .shop-tab.active { background: var(--moon-primary); color: white; border-color: var(--moon-primary); }
        .shop-tab:hover:not(.active) { background: #222; }

        .shop-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .shop-card { background: #141422; border: 1px solid #333; padding: 20px; border-radius: 8px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; gap: 10px; }
        .shop-card:hover { border-color: var(--moon-primary); transform: translateY(-3px); background: #1a1a2e; }

        .generated-code { font-family: monospace; font-size: 1.1rem; background: #000; color: var(--success); padding: 15px; text-align: center; border: 1px dashed var(--success); margin-top: 15px; word-break: break-all; border-radius: 4px; }

        footer { margin-top: auto; padding: 30px 20px; font-size: 0.8rem; color: #444; text-align: center; user-select: none; width: 100%; border-top: 1px solid #111; }

        /* GAME SPECIFIC */
        #crash-multiplier { font-size: 4rem; font-weight: bold; color: white; font-variant-numeric: tabular-nums; }
        .crashed { color: var(--danger) !important; }
        canvas { background: #000; width: 100%; height: 280px; border: 1px solid #333; border-radius: 6px; }
        
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 400px; width: 100%; }
        .mine-cell { aspect-ratio: 1; background: #222; border: 1px solid #444; border-radius: 6px; cursor: pointer; font-size: 1.5rem; display: flex; justify-content: center; align-items: center; transition: 0.2s; }
        .mine-cell:hover:not(.safe):not(.boom) { border-color: var(--moon-primary); background: #2a2a35; }
        .mine-cell.safe { background: var(--success); color: #000; border-color: var(--success); box-shadow: 0 0 15px rgba(0,242,96,0.4); }
        .mine-cell.boom { background: var(--danger); border-color: var(--danger); box-shadow: 0 0 15px rgba(245,59,87,0.4); }

        @media (max-width: 600px) {
            h1 { font-size: 1.4rem; }
            header { padding: 15px; flex-direction: column; gap: 10px; }
            .header-right { width: 100%; justify-content: center; }
            .game-container { padding: 20px; width: 95%; margin-top: 10px; }
            .nav-games { margin: 20px 10px; }
            .nav-btn { padding: 8px 12px; font-size: 0.9rem; flex: 1; text-align: center; }
            #crash-multiplier { font-size: 3rem; }
            .faucet-container { width: 180px; padding: 15px; bottom: 10px; left: 10px; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body onclick="sfx.init()">

<canvas id="confetti-canvas"></canvas>

<header>
    <h1>DINGUZ <span style="font-weight:300; font-size:1.2rem; color:var(--text-dim)">CASINO</span></h1>
    <div class="header-right">
        <div class="balance-box"><span id="balance">0</span> MC</div>
        <button class="nav-action-btn" onclick="sfx.click(); openRedeem()">üéÅ KOD</button>
        <button class="nav-action-btn" onclick="sfx.click(); openShop()">üõçÔ∏è SKLEP</button>
    </div>
</header>

<div class="nav-games">
    <button class="nav-btn active" onclick="sfx.click(); switchGame('crash')">Crash</button>
    <button class="nav-btn" onclick="sfx.click(); switchGame('mines')">Mines</button>
    <button class="nav-btn" onclick="sfx.click(); switchGame('limbo')">Limbo</button>
    <button class="nav-btn" onclick="sfx.click(); switchGame('stocks')">Stocks</button>
</div>

<div class="game-container">
    <div class="controls-bar">
        <div class="control-group">
            <label>STAWKA (MC)</label>
            <input type="number" id="bet-amount" value="100" min="1">
        </div>
        <div id="extra-controls" class="control-group"></div>
    </div>
    
    <div id="game-area"></div>
    <div id="game-actions" style="margin-top:25px; display:flex; gap:15px; width:100%"></div>
    <div style="margin-top:20px; font-size:0.75rem; color:#444; font-family:monospace; text-align:center;" id="hash-display">HASH: -</div>
</div>

<div class="faucet-container">
    <div style="font-size:0.85rem; color:var(--text-dim); font-weight:600;">DARMOWE MC</div>
    <div id="faucet-timer" style="font-size:1.2rem; font-weight:bold; color:white;">--:--:--</div>
    <button id="faucet-btn" class="faucet-btn" onclick="sfx.win(); claimFaucet()" disabled>ODBIERZ</button>
</div>

<div id="shop-modal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('shop-modal')">&times;</button>
        <div class="modal-title">Sklep z nagrodami</div>
        
        <div class="shop-tabs">
            <div class="shop-tab active" onclick="sfx.click(); filterShop('games', this)">GAMES</div>
            <div class="shop-tab" onclick="sfx.click(); filterShop('gifts', this)">GIFTS</div>
            <div class="shop-tab" onclick="sfx.click(); filterShop('giftcards', this)">GIFT CARDS</div>
        </div>

        <div class="shop-items" id="shop-container"></div>
    </div>
</div>

<div id="redeem-modal" class="modal-overlay">
    <div class="modal-content" style="max-width: 450px;">
        <button class="close-modal" onclick="closeModal('redeem-modal')">&times;</button>
        <div class="modal-title">Realizacja Kodu</div>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <label>Wpisz sw√≥j kod poni≈ºej:</label>
            <input type="text" id="redeem-input" placeholder="np. MOON-5000-XYZ">
        </div>
        <button class="action-btn" style="margin-top:10px" onclick="sfx.click(); redeemCode()">ZREALIZUJ ≈öRODKI</button>
    </div>
</div>

<div id="discord-modal" class="modal-overlay" style="z-index: 210;">
    <div class="modal-content" style="max-width: 450px;">
        <button class="close-modal" onclick="closeModal('discord-modal')">&times;</button>
        <div class="modal-title">Finalizacja Zam√≥wienia</div>
        <p style="line-height:1.5; color:var(--text-dim)">Aby≈õmy mogli dostarczyƒá TwojƒÖ nagrodƒô, potrzebujemy Twojego Discord Taga (np. <strong>@u≈ºytkownik</strong>).</p>
        <input type="text" id="discord-input" placeholder="@username">
        <button class="action-btn" style="margin-top:10px" onclick="sfx.click(); confirmPurchase()">POTWIERD≈π WYMIANƒò</button>
    </div>
</div>

<div id="admin-login-modal" class="modal-overlay" style="z-index: 300;">
    <div class="modal-content" style="max-width: 350px;">
        <button class="close-modal" onclick="closeModal('admin-login-modal')">&times;</button>
        <div class="modal-title" style="color:var(--danger)">ADMIN ACCESS</div>
        <input type="password" id="admin-pass" placeholder="Enter Security Code">
        <button class="action-btn" style="margin-top:10px; background:var(--danger)" onclick="checkAdmin()">ACCESS</button>
    </div>
</div>

<div id="admin-panel-modal" class="modal-overlay" style="z-index: 310;">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('admin-panel-modal')">&times;</button>
        <div class="modal-title" style="color:var(--danger)">PANEL STEROWANIA</div>
        
        <div style="margin-top:10px;">
            <label style="color:white; font-size:1rem;">Generator Kod√≥w</label>
            <p style="font-size:0.8rem; color:var(--text-dim); margin:5px 0 15px 0; line-height:1.4;">
                Wygeneruj unikalny kod zasilajƒÖcy. Skopiuj go i wy≈õlij graczowi.
            </p>
            <input type="number" id="admin-gen-amount" placeholder="Kwota (np. 5000)">
            <button class="action-btn" style="margin-top:15px; background:var(--moon-primary)" onclick="adminGenerateCode()">GENERUJ KOD</button>
            <div id="admin-code-output" class="generated-code" style="display:none"></div>
        </div>
    </div>
</div>

<footer onclick="triggerAdmin()">
    DISCLAIMER: This is a virtual simulator using "MoonCoins". No real money involved.<br>
    Click here 5 times for debug info.
</footer>

<script>
    // --- CONFIG ---
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1452455171723366533/AXVryGu8apz0R-Gr8jBP3EOCiPweO87OuLlo6qUkmqVipABBHfIwCd7mKt131JaXbhkR"; 
    const ADMIN_PASS = "mambachuj12"; 

    // --- SOUND SYSTEM V2 (Retro Synth) ---
    const sfx = {
        ctx: null,
        init: function() {
            // Pr√≥ba uruchomienia kontekstu audio przy pierwszym klikniƒôciu
            if (!this.ctx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            } else if (this.ctx.state === 'suspended') {
                this.ctx.resume();
            }
        },
        // Funkcja do grania pojedynczego tonu
        playOsc: function(freq, type, duration, vol=0.1, slideTo=null) {
            if(!this.ctx) return;
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            
            osc.type = type; // sine, square, sawtooth, triangle
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            
            if(slideTo) {
                osc.frequency.exponentialRampToValueAtTime(slideTo, this.ctx.currentTime + duration);
            }

            // Envelope (ADSR - Attack/Decay uproszczone)
            gain.gain.setValueAtTime(0, this.ctx.currentTime);
            gain.gain.linearRampToValueAtTime(vol, this.ctx.currentTime + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);

            osc.connect(gain);
            gain.connect(this.ctx.destination);
            
            osc.start();
            osc.stop(this.ctx.currentTime + duration);
        },
        click: function() { 
            // Kr√≥tki, wysoki "klik"
            this.playOsc(800, 'sine', 0.05, 0.1); 
        },
        win: function() { 
            // Akord C-Major (szybkie arpeggio)
            let now = 0;
            this.playOsc(523.25, 'triangle', 0.2, 0.2); // C5
            setTimeout(() => this.playOsc(659.25, 'triangle', 0.2, 0.2), 100); // E5
            setTimeout(() => this.playOsc(783.99, 'triangle', 0.4, 0.2), 200); // G5
        },
        lose: function() {
            // Niskie tƒÖpniƒôcie zjazdem w d√≥≈Ç
            this.playOsc(150, 'sawtooth', 0.3, 0.2, 50); 
        },
        tick: function() {
            // Bardzo kr√≥tki "blip"
            this.playOsc(1200, 'square', 0.03, 0.05);
        },
        cash: function() {
            // D≈∫wiƒôk monety (dwa szybkie tony)
            this.playOsc(1200, 'sine', 0.1, 0.2);
            setTimeout(()=>this.playOsc(1800, 'sine', 0.3, 0.2), 80);
        }
    };

    // --- CONFETTI SYSTEM FIXED ---
    var myConfetti = confetti.create(document.getElementById('confetti-canvas'), {
        resize: true,
        useWorker: true
    });

    function triggerConfetti() {
        // Konfetti strzelajƒÖce ze ≈õrodka
        myConfetti({
            particleCount: 150,
            spread: 100,
            origin: { y: 0.6 },
            zIndex: 10000
        });
        // Fanfary
        sfx.win();
        setTimeout(() => sfx.win(), 300);
    }


    // --- STATE ---
    let balance = 2000;
    let lastClaim = 0;
    let usedCodes = [];

    // --- INIT ---
    function init() {
        if(localStorage.getItem('moon_balance')) {
            balance = parseInt(localStorage.getItem('moon_balance'));
            lastClaim = parseInt(localStorage.getItem('moon_lastClaim') || 0);
        }
        if(localStorage.getItem('moon_usedCodes')) {
            usedCodes = JSON.parse(localStorage.getItem('moon_usedCodes'));
        }

        updateUI();
        checkFaucet();
        renderGame();
    }

    function saveState() {
        localStorage.setItem('moon_balance', balance);
        localStorage.setItem('moon_lastClaim', lastClaim);
        localStorage.setItem('moon_usedCodes', JSON.stringify(usedCodes));
    }

    function updateUI() {
        document.getElementById('balance').innerText = balance;
    }

    function updateBalance(amount) {
        balance += amount;
        updateUI();
        saveState();
        checkFaucet(); 
    }

    // --- ADMIN SYSTEM ---
    let adminClicks = 0;
    let adminClickTimer;

    function triggerAdmin() {
        sfx.click();
        adminClicks++;
        clearTimeout(adminClickTimer);
        adminClickTimer = setTimeout(() => { adminClicks = 0; }, 1000); 

        if(adminClicks >= 5) {
            document.getElementById('admin-login-modal').style.display = 'flex';
            adminClicks = 0;
        }
    }

    function checkAdmin() {
        const pass = document.getElementById('admin-pass').value;
        if(pass === ADMIN_PASS) {
            sfx.cash();
            closeModal('admin-login-modal');
            document.getElementById('admin-panel-modal').style.display = 'flex';
        } else {
            sfx.lose();
            alert("B≈ÅƒòDNY KOD / ACCESS DENIED");
        }
    }

    function adminGenerateCode() {
        sfx.click();
        const amount = parseInt(document.getElementById('admin-gen-amount').value);
        if(!amount || amount <= 0) return;

        const checkSumVal = (amount * 73) + 12345;
        const checkSum = checkSumVal.toString(36).toUpperCase();
        const rand = Math.random().toString(36).substring(2,5).toUpperCase();

        const code = `MOON-${amount}-${checkSum}-${rand}`;
        
        const out = document.getElementById('admin-code-output');
        out.style.display = 'block';
        out.innerText = code;
    }

    // --- REDEEM SYSTEM ---
    function openRedeem() {
        document.getElementById('redeem-modal').style.display = 'flex';
    }

    function redeemCode() {
        const input = document.getElementById('redeem-input').value.trim().toUpperCase();
        if(!input.startsWith("MOON-")) return alert("Nieprawid≈Çowy format kodu.");
        
        if(usedCodes.includes(input)) return alert("Ten kod zosta≈Ç ju≈º wykorzystany!");

        const parts = input.split('-');
        if(parts.length !== 4) return alert("B≈Çƒôdny kod.");

        const amount = parseInt(parts[1]);
        const providedChecksum = parts[2];

        // Weryfikacja
        const expectedCheckSumVal = (amount * 73) + 12345;
        const expectedChecksum = expectedCheckSumVal.toString(36).toUpperCase();

        if(providedChecksum === expectedChecksum) {
            sfx.cash();
            updateBalance(amount);
            usedCodes.push(input);
            saveState();
            alert(`Sukces! Dodano ${amount} MC do konta.`);
            closeModal('redeem-modal');
        } else {
            sfx.lose();
            alert("Kod nieprawid≈Çowy lub sfa≈Çszowany.");
        }
    }

    // --- MODALS ---
    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
    }

    // --- SHOP SYSTEM ---
    const shopData = {
        games: [
            { name: "Wybrana gra (do 10PLN)", price: 10000, desc: "Steam Key / Gift" },
            { name: "Wybrana gra (do 20PLN)", price: 18000, desc: "Steam Key / Gift" }
        ],
        gifts: [
            { name: "Gamepass Gift Roblox", price: 5000, desc: "Max. 80 Robux" },
            { name: "Gamepass Gift Roblox", price: 22000, desc: "Max. 400 Robux" }
        ],
        giftcards: [
            { name: "BloxGame Card 1000", price: 8000, desc: "1000 Coins Value" },
            { name: "BloxGame Card 2000", price: 15000, desc: "2000 Coins Value" }
        ]
    };

    let pendingItem = null;

    function openShop() {
        document.getElementById('shop-modal').style.display = 'flex';
        filterShop('games', document.querySelector('.shop-tab')); 
    }

    function filterShop(category, btnElement) {
        document.querySelectorAll('.shop-tab').forEach(b => b.classList.remove('active'));
        if(btnElement) btnElement.classList.add('active');
        else document.querySelector('.shop-tab').classList.add('active'); 

        const container = document.getElementById('shop-container');
        container.innerHTML = '';

        if(shopData[category]) {
            shopData[category].forEach(item => {
                container.innerHTML += `
                    <div class="shop-card">
                        <h3 style="margin:0; color:var(--moon-secondary); font-size:1.1rem;">${item.name}</h3>
                        <div style="font-size:0.9rem; color:#888">${item.desc}</div>
                        <div style="font-size:1.4rem; font-weight:bold; margin:5px 0">${item.price} MC</div>
                        <button class="nav-action-btn" style="width:100%; margin-top:auto;" onclick="sfx.click(); buyItem('${item.name}', ${item.price})">WYMIE≈É</button>
                    </div>
                `;
            });
        }
    }

    function buyItem(name, price) {
        if(balance < price) { sfx.lose(); return alert("Za ma≈Ço MoonCoins!"); }
        pendingItem = {name, price};
        closeModal('shop-modal');
        document.getElementById('discord-modal').style.display = 'flex';
    }

    function confirmPurchase() {
        const nick = document.getElementById('discord-input').value;
        if(nick.length < 3) return alert("Podaj poprawny nick!");
        
        updateBalance(-pendingItem.price);
        sfx.cash();
        
        fetch(WEBHOOK_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                content: "üõí **NOWY ZAKUP!**",
                embeds: [{
                    title: "Szczeg√≥≈Çy zam√≥wienia",
                    color: 5192959,
                    fields: [
                        {name: "Discord", value: nick, inline: true},
                        {name: "Przedmiot", value: pendingItem.name},
                        {name: "Cena", value: pendingItem.price + " MC"}
                    ]
                }]
            })
        });
        alert("Zam√≥wienie wys≈Çane! Admin skontaktuje siƒô na Discordzie.");
        closeModal('discord-modal');
    }

    // --- FAUCET ---
    function checkFaucet() {
        const btn = document.getElementById('faucet-btn');
        const timer = document.getElementById('faucet-timer');
        
        if(balance >= 1000) {
            btn.disabled = true;
            btn.innerText = "MAX SALDO";
            timer.innerText = "> 1000 MC";
            return;
        }

        const now = Date.now();
        const diff = now - lastClaim;
        const waitTime = 3600000; // 1h

        if(diff >= waitTime) {
            btn.disabled = false;
            btn.innerText = "ODBIERZ";
            timer.innerText = "GOTOWE";
        } else {
            btn.disabled = true;
            const left = waitTime - diff;
            const m = Math.floor((left % (1000*60*60))/(1000*60));
            const s = Math.floor((left % (1000*60))/1000);
            timer.innerText = `${m}m ${s}s`;
            setTimeout(checkFaucet, 1000);
        }
    }

    function claimFaucet() {
        if(balance >= 1000) return;
        updateBalance(100);
        lastClaim = Date.now();
        saveState();
        checkFaucet();
    }

    // --- GAMES LOGIC ---
    let currentGame = 'crash';
    let gameActive = false;
    let gameInterval;

    function generateHash() {
        return Math.random().toString(36).substring(2) + Math.random().toString(36).substring(2);
    }

    function getBet() {
        const val = parseInt(document.getElementById('bet-amount').value);
        if(!val || val <= 0) { alert("Z≈Ça stawka"); return null; }
        if(val > balance) { alert("Brak ≈õrodk√≥w"); return null; }
        return val;
    }

    function switchGame(game) {
        if(gameActive) return alert("Sko≈Ñcz grƒô");
        currentGame = game;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        renderGame();
    }

    function renderGame() {
        const area = document.getElementById('game-area');
        const actions = document.getElementById('game-actions');
        const extra = document.getElementById('extra-controls');
        area.innerHTML = ''; actions.innerHTML = ''; extra.innerHTML = '';
        document.getElementById('hash-display').innerText = "HASH: -";

        if(currentGame === 'crash') {
            area.innerHTML = `<div id="crash-multiplier">1.00x</div>`;
            actions.innerHTML = `<button class="action-btn" id="c-play" onclick="sfx.click(); playCrash()">GRAJ</button><button class="action-btn cashout-btn" id="c-out" onclick="crashOut()" disabled>WYP≈ÅAƒÜ</button>`;
        } else if (currentGame === 'mines') {
            extra.innerHTML = `<label>MINY (1-24)</label><input type="number" id="mines-cnt" value="3" min="1" max="24">`;
            area.innerHTML = `<div class="mines-grid" id="mines-grid"></div><div id="mines-info" style="margin-top:15px; font-weight:bold; font-size:1.1rem; color:white;"></div>`;
            actions.innerHTML = `<button class="action-btn" id="m-play" onclick="sfx.click(); playMines()">GRAJ</button><button class="action-btn cashout-btn" id="m-out" onclick="minesCashout()" disabled>WYP≈ÅAƒÜ</button>`;
            initMines();
        } else if (currentGame === 'limbo') {
             extra.innerHTML = `<label>CEL (x)</label><input type="number" id="limbo-target" value="2.0" step="0.1">`;
             area.innerHTML = `<div id="limbo-res" style="font-size:4rem; font-weight:bold; color:#555">0.00x</div>`;
             actions.innerHTML = `<button class="action-btn" onclick="sfx.click(); playLimbo()">GRAJ</button>`;
        } else if (currentGame === 'stocks') {
             area.innerHTML = `<canvas id="stockCanvas"></canvas><div id="stock-res" style="margin-top:10px; font-weight:bold">RYNEK ZAMKNIƒòTY</div>`;
             actions.innerHTML = `<button class="action-btn" style="background:#00f260; color:black" onclick="sfx.click(); playStocks('up')">UP ‚Üó</button><button class="action-btn" style="background:#f53b57; color:white" onclick="sfx.click(); playStocks('down')">DOWN ‚Üò</button>`;
             drawStockChart([]);
        }
    }

    // --- GAME IMPLS ---
    // CRASH
    let crashVal = 1, curMult = 1;
    function playCrash() {
        const bet = getBet(); if(!bet) return;
        updateBalance(-bet);
        gameActive = true;
        document.getElementById('c-play').disabled = true; document.getElementById('c-out').disabled = false;
        document.getElementById('crash-multiplier').classList.remove('crashed');
        document.getElementById('hash-display').innerText = "HASH: " + generateHash();
        
        crashVal = (Math.floor(100/(Math.random()*100+1)*100)/100); if(crashVal<1.01) crashVal=1.00;
        curMult = 1.00;
        
        let ticks = 0;
        gameInterval = setInterval(()=>{
            ticks++;
            if(ticks % 10 === 0) sfx.tick(); 
            
            curMult += 0.01+(curMult*0.004);
            document.getElementById('crash-multiplier').innerText = curMult.toFixed(2)+'x';
            if(curMult >= crashVal) {
                clearInterval(gameInterval);
                sfx.lose();
                document.getElementById('crash-multiplier').innerText = "CRASH @ " + crashVal.toFixed(2)+"x";
                document.getElementById('crash-multiplier').classList.add('crashed');
                gameActive = false;
                document.getElementById('c-play').disabled = false; document.getElementById('c-out').disabled = true;
            }
        }, 50);
    }
    function crashOut() {
        if(!gameActive) return;
        clearInterval(gameInterval);
        const bet = parseInt(document.getElementById('bet-amount').value);
        updateBalance(Math.floor(bet*curMult));
        
        if(curMult >= 10.0) triggerConfetti();
        else sfx.win();

        gameActive = false;
        document.getElementById('c-play').disabled = false; document.getElementById('c-out').disabled = true;
    }

    // MINES
    let minesMap=[], revealed=0, totalMines=3;
    function initMines() {
        const g = document.getElementById('mines-grid'); g.innerHTML='';
        for(let i=0;i<25;i++) g.innerHTML+='<div class="mine-cell" style="opacity:0.3"></div>';
    }
    function playMines() {
        const bet = getBet(); if(!bet) return;
        updateBalance(-bet);
        totalMines = parseInt(document.getElementById('mines-cnt').value);
        gameActive = true; revealed=0;
        document.getElementById('m-play').disabled=true; document.getElementById('m-out').disabled=false;
        minesMap=Array(25).fill(false);
        let p=0; while(p<totalMines){let x=Math.floor(Math.random()*25); if(!minesMap[x]){minesMap[x]=true;p++;}}
        const g = document.getElementById('mines-grid'); g.innerHTML='';
        for(let i=0;i<25;i++){
            let d=document.createElement('div'); d.className='mine-cell';
            d.onclick=()=>hitMine(i,d); g.appendChild(d);
        }
        document.getElementById('mines-info').innerText = "Safe: 0";
    }
    function hitMine(i, el) {
        if(!gameActive || el.classList.contains('safe')) return;
        if(minesMap[i]) {
            el.classList.add('boom'); el.innerText='üí£';
            sfx.lose();
            gameActive=false;
            document.getElementById('m-play').disabled=false; document.getElementById('m-out').disabled=true;
            document.getElementById('mines-info').innerText="BOOM!";
            document.querySelectorAll('.mine-cell').forEach((c,idx)=>{if(minesMap[idx])c.innerText='üí£'});
        } else {
            sfx.click(); 
            el.classList.add('safe'); el.innerText='üíé'; revealed++;
            let m=1; for(let k=0;k<revealed;k++) m*=(25-k)/(25-totalMines-k);
            document.getElementById('mines-info').innerText = `Win: ${Math.floor(parseInt(document.getElementById('bet-amount').value)*m)} MC (${m.toFixed(2)}x)`;
        }
    }
    function minesCashout() {
        if(!gameActive) return;
        let m=1; for(let k=0;k<revealed;k++) m*=(25-k)/(25-totalMines-k);
        updateBalance(Math.floor(parseInt(document.getElementById('bet-amount').value)*m));
        
        if(m >= 10.0) triggerConfetti();
        else sfx.win();

        gameActive=false;
        document.getElementById('m-play').disabled=false; document.getElementById('m-out').disabled=true;
    }

    // LIMBO
    function playLimbo() {
        const bet = getBet(); if(!bet) return;
        const target = parseFloat(document.getElementById('limbo-target').value);
        if(target<=1.0) return alert("Target > 1.0");
        updateBalance(-bet);
        let r = (Math.floor(100/(Math.random()*100+1)*100)/100); if(r<1.01) r=1.00;
        const el = document.getElementById('limbo-res'); el.innerText=r.toFixed(2)+'x';
        if(r>=target) { 
            el.style.color="#00f260"; 
            updateBalance(Math.floor(bet*target));
            if(target >= 10.0) triggerConfetti();
            else sfx.win();
        }
        else { 
            el.style.color="#f53b57"; 
            sfx.lose();
        }
    }

    // STOCKS
    function drawStockChart(data) {
        const c = document.getElementById('stockCanvas'); if(!c) return;
        const ctx = c.getContext('2d'); c.width=c.offsetWidth; c.height=c.offsetHeight;
        ctx.fillStyle="black"; ctx.fillRect(0,0,c.width,c.height);
        if(data.length<2) return;
        const up = data[data.length-1]>=data[0];
        ctx.strokeStyle = up ? '#00f260' : '#f53b57'; ctx.lineWidth=3;
        ctx.beginPath();
        let min=Math.min(...data), max=Math.max(...data), range=max-min||1;
        data.forEach((v,i)=>{
            let x=(i/(data.length-1))*c.width;
            let y=c.height-((v-min)/range)*(c.height-40)-20;
            if(i==0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.stroke();
    }
    function playStocks(dir) {
        if(gameActive) return;
        const bet = getBet(); if(!bet) return;
        updateBalance(-bet);
        gameActive=true;
        let p=100, h=[100], t=0;
        const inter = setInterval(()=>{
            p+=(Math.random()-0.5)*10; h.push(p); if(h.length>50) h.shift();
            drawStockChart(h); t++;
            if(t>=40) {
                clearInterval(inter); gameActive=false;
                const w = (dir=='up' && h[h.length-1]>h[0]) || (dir=='down' && h[h.length-1]<h[0]);
                document.getElementById('stock-res').innerText = w ? "WYGRANA!" : "PRZEGRANA";
                document.getElementById('stock-res').style.color = w ? "#00f260" : "#f53b57";
                if(w) {
                    sfx.win();
                    updateBalance(Math.floor(bet*1.9));
                } else {
                    sfx.lose();
                }
            }
        }, 50);
    }

    init();

</script>
</body>
</html>
