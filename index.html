<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINGUZ CASINO | MOON</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* --- GLOBAL & RESET --- */
        * { box-sizing: border-box; }

        :root {
            --bg-main: #050510;
            --bg-panel: #0f0f1f;
            --moon-primary: #7d5fff;
            --moon-secondary: #4facfe;
            --text-main: #fff;
            --text-dim: #8892b0;
            --success: #00f260;
            --danger: #f53b57;
            --glass-border: 1px solid rgba(125, 95, 255, 0.2);
            --glow: 0 0 20px rgba(125, 95, 255, 0.4);
        }

        body {
            background: radial-gradient(circle at 50% -20%, #1a1a40 0%, var(--bg-main) 80%);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- REAL LIVE ANNOUNCEMENT BANNER --- */
        #live-announcement {
            position: fixed;
            top: -150px;
            left: 0;
            width: 100%;
            background: linear-gradient(45deg, #ff0000, #ff5500);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 800;
            font-size: 1.5rem;
            z-index: 20000;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.8);
            transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            border-bottom: 2px solid #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        #live-announcement.active { top: 0; }
        .blink-icon { animation: blink 0.5s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }

        /* --- INPUT CUSTOMIZATION --- */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        input[type="number"], input[type="text"], input[type="password"], select, textarea {
            background: #050510;
            border: 1px solid #333;
            color: white;
            padding: 12px 15px;
            font-family: inherit;
            font-size: 1.1rem;
            width: 100%;
            border-radius: 6px;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        input:focus, select:focus, textarea:focus { 
            border-color: var(--moon-primary); 
            outline: none; 
            box-shadow: 0 0 15px rgba(125, 95, 255, 0.5), inset 0 0 10px rgba(125, 95, 255, 0.1);
        }

        /* --- BET CONTROLS --- */
        .input-group { display: flex; gap: 5px; }
        .input-group input { border-top-right-radius: 0; border-bottom-right-radius: 0; }
        .bet-ctrl-btn {
            background: #1a1a2e; border: 1px solid #333; color: var(--text-dim);
            font-weight: bold; cursor: pointer; padding: 0 12px; font-size: 0.9rem;
            transition: 0.2s; border-left: none;
        }
        .bet-ctrl-btn:hover { background: #2a2a40; color: white; }
        .bet-ctrl-btn:last-child { border-top-right-radius: 6px; border-bottom-right-radius: 6px; }

        /* --- TOASTS --- */
        #notification-area { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast {
            background: rgba(15, 15, 31, 0.95); border: 1px solid; padding: 15px 25px;
            border-radius: 8px; min-width: 300px; text-align: center; font-weight: bold;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5); animation: slideIn 0.3s ease-out;
            pointer-events: auto; backdrop-filter: blur(5px);
        }
        .toast.success { border-color: var(--success); color: var(--success); box-shadow: 0 0 15px rgba(0, 242, 96, 0.2); }
        .toast.error { border-color: var(--danger); color: var(--danger); box-shadow: 0 0 15px rgba(245, 59, 87, 0.2); }
        @keyframes slideIn { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 9999; background: transparent; }

        /* --- HEADER & NAV --- */
        header { width: 100%; padding: 15px 5%; background: rgba(15, 15, 31, 0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-between; align-items: center; border-bottom: var(--glass-border); position: sticky; top: 0; z-index: 100; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        h1 { margin: 0; font-size: 1.8rem; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; background: linear-gradient(to right, #fff, #7d5fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; white-space: nowrap; }
        .header-right { display: flex; gap: 10px; align-items: center; }
        .balance-box { background: linear-gradient(90deg, rgba(125,95,255,0.1), transparent); padding: 8px 15px; border-radius: 4px; border-left: 3px solid var(--moon-primary); font-size: 1.1rem; font-weight: 700; color: var(--moon-secondary); text-shadow: 0 0 10px rgba(79, 172, 254, 0.5); white-space: nowrap; }
        button.nav-action-btn { background: transparent; border: 1px solid var(--moon-primary); color: white; padding: 8px 12px; font-weight: bold; border-radius: 4px; cursor: pointer; text-transform: uppercase; transition: 0.3s; font-size: 0.75rem; white-space: nowrap; }
        button.nav-action-btn:hover { background: var(--moon-primary); box-shadow: var(--glow); }

        .nav-games { margin: 30px 20px; display: flex; gap: 8px; padding: 8px; background: var(--bg-panel); border-radius: 8px; border: var(--glass-border); flex-wrap: wrap; justify-content: center; }
        .nav-btn { background: transparent; border: 1px solid transparent; color: var(--text-dim); padding: 10px 20px; cursor: pointer; font-family: inherit; font-weight: 600; font-size: 1rem; transition: 0.3s; text-transform: uppercase; border-radius: 4px; }
        .nav-btn.active { color: var(--text-main); background: rgba(125, 95, 255, 0.1); border: 1px solid var(--moon-primary); text-shadow: 0 0 10px var(--moon-primary); }

        /* --- GAME CONTAINER --- */
        .game-container { background: var(--bg-panel); width: 95%; max-width: 850px; padding: 30px; border-radius: 12px; border: var(--glass-border); box-shadow: 0 20px 50px rgba(0,0,0,0.7); position: relative; min-height: 450px; display: flex; flex-direction: column; margin-bottom: 40px; }
        .controls-bar { display: flex; gap: 20px; margin-bottom: 25px; align-items: flex-end; padding-bottom: 25px; border-bottom: 1px solid rgba(255,255,255,0.05); flex-wrap: wrap; }
        .control-group { flex: 1; min-width: 150px; display: flex; flex-direction: column; gap: 8px; }
        label { color: var(--text-dim); font-size: 0.8rem; font-weight: 600; letter-spacing: 1px; }

        button.action-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--moon-primary), var(--moon-secondary)); border: none; color: white; font-weight: bold; font-size: 1.2rem; cursor: pointer; text-transform: uppercase; border-radius: 6px; transition: 0.2s; margin-top: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        button.action-btn:hover:not(:disabled) { transform: translateY(-2px); filter: brightness(1.1); }
        button.action-btn:disabled { background: #222; color: #555; cursor: not-allowed; box-shadow: none; transform: none; }
        button.cashout-btn { background: var(--success); color: #000; }
        button.put-btn { background: var(--danger); color: #fff; }

        #game-area { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; padding: 20px 0; }

        /* --- TOWER GAME STYLES --- */
        .tower-container { display: flex; flex-direction: column-reverse; gap: 8px; width: 100%; }
        .tower-row { display: grid; gap: 8px; width: 100%; } 
        
        .tower-cell { 
            height: 60px;
            background: #1a1a2e; border: 1px solid #333; 
            border-radius: 6px; cursor: pointer; display: flex; justify-content: center; align-items: center;
            font-size: 1rem; font-weight: bold; color: #666; transition: 0.2s;
            font-family: monospace;
        }
        
        .tower-row.disabled .tower-cell { opacity: 0.3; pointer-events: none; border-color: transparent; }
        .tower-row.active .tower-cell { background: #222; border-color: #555; color: white; cursor: pointer; }
        .tower-row.active .tower-cell:hover { background: #2a2a40; border-color: var(--moon-primary); box-shadow: 0 0 10px rgba(125,95,255,0.4); }
        
        .tower-cell.safe { background: var(--success) !important; box-shadow: 0 0 15px rgba(0,242,96,0.3); border-color: var(--success) !important; color: #000 !important; font-size: 1.5rem; }
        .tower-cell.boom { background: var(--danger) !important; box-shadow: 0 0 15px rgba(245,59,87,0.3); border-color: var(--danger) !important; font-size: 1.5rem; color:white; }
        .tower-cell.revealed-gem { background: #333 !important; color: #fff !important; opacity: 0.6; font-size: 1.5rem; }

        /* --- OTHER --- */
        .faucet-container { position: fixed; bottom: 20px; left: 20px; background: rgba(15,15,31,0.95); border: var(--glass-border); padding: 20px; border-radius: 8px; z-index: 90; display: flex; flex-direction: column; gap: 8px; width: 220px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .faucet-btn { background: var(--moon-secondary); border: none; color: #000; padding: 10px; font-weight: bold; cursor: pointer; border-radius: 4px; width: 100%; }
        .faucet-btn:disabled { background: #333; color: #555; cursor: default; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); z-index: 200; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: var(--bg-panel); width: 100%; max-width: 800px; border: var(--glass-border); border-radius: 12px; padding: 30px; display: flex; flex-direction: column; gap: 20px; box-shadow: 0 0 50px rgba(125,95,255,0.3); position: relative; max-height: 90vh; overflow-y: auto; }
        .close-modal { position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 2rem; cursor: pointer; line-height: 1; }
        .modal-title { font-size: 1.5rem; color: var(--moon-primary); font-weight: 700; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 15px; }

        .shop-tabs { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .shop-tab { flex: 1; padding: 12px; background: #1a1a2e; border: 1px solid #333; color: #888; cursor: pointer; border-radius: 6px; transition: 0.2s; font-weight: bold; text-align: center; white-space: nowrap; }
        .shop-tab.active { background: var(--moon-primary); color: white; border-color: var(--moon-primary); }
        .shop-tab:hover:not(.active) { background: #222; }

        .shop-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .shop-card { background: #141422; border: 1px solid #333; padding: 20px; border-radius: 8px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; gap: 10px; }
        .shop-card:hover { border-color: var(--moon-primary); transform: translateY(-3px); background: #1a1a2e; }

        .generated-code { font-family: monospace; font-size: 1.1rem; background: #000; color: var(--success); padding: 15px; text-align: center; border: 1px dashed var(--success); margin-top: 15px; word-break: break-all; border-radius: 4px; }
        footer { margin-top: auto; padding: 30px 20px; font-size: 0.8rem; color: #444; text-align: center; user-select: none; width: 100%; border-top: 1px solid #111; }

        /* GAME SPECIFIC */
        #crash-multiplier { font-size: 4rem; font-weight: bold; color: white; font-variant-numeric: tabular-nums; }
        .crashed { color: var(--danger) !important; }
        canvas { background: #000; width: 100%; height: 280px; border: 1px solid #333; border-radius: 6px; }
        
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 400px; width: 100%; }
        .mine-cell { aspect-ratio: 1; background: #222; border: 1px solid #444; border-radius: 6px; cursor: pointer; font-size: 1.5rem; display: flex; justify-content: center; align-items: center; transition: 0.2s; }
        .mine-cell:hover:not(.safe):not(.boom) { border-color: var(--moon-primary); background: #2a2a35; }
        .mine-cell.safe { background: var(--success); color: #000; border-color: var(--success); box-shadow: 0 0 15px rgba(0,242,96,0.4); }
        .mine-cell.boom { background: var(--danger); border-color: var(--danger); box-shadow: 0 0 15px rgba(245,59,87,0.4); }

        @media (max-width: 600px) {
            h1 { font-size: 1.4rem; }
            header { padding: 15px; flex-direction: column; gap: 10px; }
            .header-right { width: 100%; justify-content: center; }
            .game-container { padding: 20px; width: 95%; margin-top: 10px; }
            .nav-games { margin: 20px 10px; }
            .nav-btn { padding: 8px 12px; font-size: 0.9rem; flex: 1; text-align: center; }
            #crash-multiplier { font-size: 3rem; }
            .faucet-container { width: 180px; padding: 15px; bottom: 10px; left: 10px; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body onclick="sfx.init()">

<div id="live-announcement"><span class="blink-icon">‚ö†Ô∏è</span> <span id="ann-text">LIVE ALERT</span> <span class="blink-icon">‚ö†Ô∏è</span></div>
<div id="notification-area"></div>
<canvas id="confetti-canvas"></canvas>

<header>
    <h1>DINGUZ <span style="font-weight:300; font-size:1.2rem; color:var(--text-dim)">CASINO</span></h1>
    <div class="header-right">
        <div class="balance-box"><span id="balance">0</span> MC</div>
        <button class="nav-action-btn" onclick="sfx.click(); openRedeem()">üéÅ KOD</button>
        <button class="nav-action-btn" onclick="sfx.click(); openShop()">üõçÔ∏è SKLEP</button>
    </div>
</header>

<div class="nav-games">
    <button class="nav-btn active" onclick="sfx.click(); switchGame('crash')">Crash</button>
    <button class="nav-btn" onclick="sfx.click(); switchGame('mines')">Mines</button>
    <button class="nav-btn" onclick="sfx.click(); switchGame('tower')">Tower</button>
    <button class="nav-btn" onclick="sfx.click(); switchGame('limbo')">Limbo</button>
    <button class="nav-btn" onclick="sfx.click(); switchGame('stocks')">Stocks</button>
</div>

<div class="game-container">
    <div class="controls-bar">
        <div class="control-group">
            <label>STAWKA (MC)</label>
            <div class="input-group">
                <input type="number" id="bet-amount" value="100" min="1">
                <button class="bet-ctrl-btn" onclick="betUtils.half()">¬Ω</button>
                <button class="bet-ctrl-btn" onclick="betUtils.double()">x2</button>
                <button class="bet-ctrl-btn" onclick="betUtils.max()">MAX</button>
            </div>
        </div>
        <div id="extra-controls" class="control-group"></div>
    </div>
    
    <div id="game-area"></div>
    <div id="game-actions" style="margin-top:25px; display:flex; gap:15px; width:100%"></div>
    <div style="margin-top:20px; font-size:0.75rem; color:#444; font-family:monospace; text-align:center;" id="hash-display">HASH: -</div>
</div>

<div class="faucet-container">
    <div style="font-size:0.85rem; color:var(--text-dim); font-weight:600;">DARMOWE MC</div>
    <div id="faucet-timer" style="font-size:1.2rem; font-weight:bold; color:white;">--:--:--</div>
    <button id="faucet-btn" class="faucet-btn" onclick="sfx.win(); claimFaucet()" disabled>ODBIERZ</button>
</div>

<div id="shop-modal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('shop-modal')">&times;</button>
        <div class="modal-title">Sklep z nagrodami</div>
        <div class="shop-tabs">
            <div class="shop-tab active" onclick="sfx.click(); filterShop('games', this)">GAMES</div>
            <div class="shop-tab" onclick="sfx.click(); filterShop('gifts', this)">GIFTS</div>
            <div class="shop-tab" onclick="sfx.click(); filterShop('giftcards', this)">GIFT CARDS</div>
        </div>
        <div class="shop-items" id="shop-container"></div>
    </div>
</div>

<div id="redeem-modal" class="modal-overlay">
    <div class="modal-content" style="max-width: 450px;">
        <button class="close-modal" onclick="closeModal('redeem-modal')">&times;</button>
        <div class="modal-title">Realizacja Kodu</div>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <label>Wpisz sw√≥j kod poni≈ºej:</label>
            <input type="text" id="redeem-input" placeholder="np. MOON-5000-XYZ">
        </div>
        <button class="action-btn" style="margin-top:10px" onclick="sfx.click(); redeemCode()">ZREALIZUJ ≈öRODKI</button>
    </div>
</div>

<div id="discord-modal" class="modal-overlay" style="z-index: 210;">
    <div class="modal-content" style="max-width: 450px;">
        <button class="close-modal" onclick="closeModal('discord-modal')">&times;</button>
        <div class="modal-title">Finalizacja Zam√≥wienia</div>
        <p style="line-height:1.5; color:var(--text-dim)">Aby≈õmy mogli dostarczyƒá TwojƒÖ nagrodƒô, potrzebujemy Twojego Discord Taga (np. <strong>@u≈ºytkownik</strong>).</p>
        <input type="text" id="discord-input" placeholder="@username">
        <button class="action-btn" style="margin-top:10px" onclick="sfx.click(); confirmPurchase()">POTWIERD≈π WYMIANƒò</button>
    </div>
</div>

<div id="success-modal" class="modal-overlay" style="z-index: 220;">
    <div class="modal-content" style="max-width: 400px; text-align:center;">
        <button class="close-modal" onclick="closeModal('success-modal')">&times;</button>
        <div style="font-size:3rem; margin-bottom:10px;">üéâ</div>
        <div class="modal-title" style="color:var(--success); border:none;">SUKCES!</div>
        <p style="color:#ddd;">Twoje zam√≥wienie zosta≈Ço wys≈Çane do administracji.</p>
        <p style="font-size:0.9rem; color:var(--text-dim);">Sprawd≈∫ Discorda wkr√≥tce.</p>
        <button class="action-btn" style="background:var(--success); color:#000" onclick="closeModal('success-modal')">OK</button>
    </div>
</div>

<div id="admin-login-modal" class="modal-overlay" style="z-index: 300;">
    <div class="modal-content" style="max-width: 350px;">
        <button class="close-modal" onclick="closeModal('admin-login-modal')">&times;</button>
        <div class="modal-title" style="color:var(--danger)">ADMIN ACCESS</div>
        <input type="password" id="admin-pass" placeholder="Enter Security Code">
        <button class="action-btn" style="margin-top:10px; background:var(--danger)" onclick="checkAdmin()">ACCESS</button>
    </div>
</div>

<div id="admin-panel-modal" class="modal-overlay" style="z-index: 310;">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('admin-panel-modal')">&times;</button>
        <div class="modal-title" style="color:var(--danger)">PANEL STEROWANIA</div>
        
        <div style="margin-top:10px; border-bottom:1px solid #333; padding-bottom:20px;">
            <label style="color:white; font-size:1rem;">Generator Kod√≥w</label>
            <p style="font-size:0.8rem; color:var(--text-dim); margin:5px 0 15px 0;">
                Wygeneruj unikalny kod zasilajƒÖcy.
            </p>
            <input type="number" id="admin-gen-amount" placeholder="Kwota (np. 5000)">
            <button class="action-btn" style="margin-top:15px; background:var(--moon-primary)" onclick="adminGenerateCode()">GENERUJ KOD</button>
            <div id="admin-code-output" class="generated-code" style="display:none"></div>
        </div>

        <div style="margin-top:20px;">
            <label style="color:white; font-size:1rem; color: #ff5500;">üî¥ LIVE ANNOUNCEMENT</label>
            <p style="font-size:0.8rem; color:var(--text-dim); margin:5px 0 15px 0;">
                Wy≈õlij globalny komunikat (real-time).
            </p>
            <textarea id="admin-announce-text" rows="3" placeholder="Wpisz tre≈õƒá og≈Çoszenia..."></textarea>
            <button class="action-btn" style="margin-top:15px; background:#ff5500" onclick="sendAnnouncement()">WY≈öLIJ ALARM</button>
        </div>
    </div>
</div>

<footer onclick="triggerAdmin()">Dinguz Casino Simulator &copy; 2024. All rights reserved.</footer>

<script>
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1452455171723366533/AXVryGu8apz0R-Gr8jBP3EOCiPweO87OuLlo6qUkmqVipABBHfIwCd7mKt131JaXbhkR"; 
    const ADMIN_PASS = "mambachuj12"; 
    const NTFY_TOPIC = "dinguz_casino_live_alerts_x9z"; // Unikalny temat

    // --- NOTIFICATIONS ---
    function showNotify(msg, type='info') {
        const container = document.getElementById('notification-area');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerText = msg;
        container.appendChild(toast);
        if(type === 'success') sfx.cash();
        if(type === 'error') sfx.lose();
        setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
    }

    // --- SOUND & CONFETTI ---
    const sfx = {
        ctx: null,
        init: function() {
            if (!this.ctx) { const AudioContext = window.AudioContext || window.webkitAudioContext; this.ctx = new AudioContext(); } 
            else if (this.ctx.state === 'suspended') this.ctx.resume();
        },
        playOsc: function(freq, type, duration, vol=0.1, slideTo=null) {
            if(!this.ctx) return;
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            if(slideTo) osc.frequency.exponentialRampToValueAtTime(slideTo, this.ctx.currentTime + duration);
            gain.gain.setValueAtTime(0, this.ctx.currentTime);
            gain.gain.linearRampToValueAtTime(vol, this.ctx.currentTime + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
            osc.connect(gain); gain.connect(this.ctx.destination);
            osc.start(); osc.stop(this.ctx.currentTime + duration);
        },
        click: function() { this.playOsc(800, 'sine', 0.05, 0.1); },
        win: function() { this.playOsc(523.25, 'triangle', 0.2, 0.2); setTimeout(() => this.playOsc(659.25, 'triangle', 0.2, 0.2), 100); setTimeout(() => this.playOsc(783.99, 'triangle', 0.4, 0.2), 200); },
        lose: function() { this.playOsc(150, 'sawtooth', 0.3, 0.2, 50); },
        tick: function() { this.playOsc(1200, 'square', 0.03, 0.05); },
        cash: function() { this.playOsc(1200, 'sine', 0.1, 0.2); setTimeout(()=>this.playOsc(1800, 'sine', 0.3, 0.2), 80); },
        alarm: function() { 
            const now = this.ctx.currentTime;
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(440, now);
            osc.frequency.linearRampToValueAtTime(880, now + 0.5);
            osc.frequency.linearRampToValueAtTime(440, now + 1.0);
            gain.gain.value = 0.1;
            osc.connect(gain); gain.connect(this.ctx.destination);
            osc.start(); osc.stop(now + 2);
        }
    };

    var myConfetti = confetti.create(document.getElementById('confetti-canvas'), { resize: true, useWorker: true });
    function triggerConfetti() { myConfetti({ particleCount: 150, spread: 100, origin: { y: 0.6 }, zIndex: 10000 }); sfx.win(); setTimeout(() => sfx.win(), 300); }

    // --- ANNOUNCEMENTS (REAL TIME via ntfy.sh) ---
    function sendAnnouncement() {
        const text = document.getElementById('admin-announce-text').value;
        if(!text) return;
        
        // Push to ntfy.sh (Public subscribe topic)
        fetch(`https://ntfy.sh/${NTFY_TOPIC}`, {
            method: 'POST',
            body: text
        })
        .then(response => {
            if(response.ok) {
                showNotify("Og≈Çoszenie wys≈Çane do wszystkich!", 'success');
                document.getElementById('admin-announce-text').value = '';
            } else {
                showNotify("B≈ÇƒÖd wysy≈Çania", 'error');
            }
        });

        // Backup to Discord
        fetch(WEBHOOK_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                content: "üì¢ **LIVE ANNOUNCEMENT** @everyone",
                embeds: [{ description: text, color: 16711680 }]
            })
        });
    }

    // LISTENER FOR EVERYONE
    const eventSource = new EventSource(`https://ntfy.sh/${NTFY_TOPIC}/sse`);
    eventSource.onmessage = (e) => {
        const text = e.data;
        const banner = document.getElementById('live-announcement');
        document.getElementById('ann-text').innerText = text;
        banner.classList.add('active');
        sfx.alarm();
        setTimeout(() => banner.classList.remove('active'), 6000);
    };

    // --- UTILS ---
    const betUtils = {
        get input() { return document.getElementById('bet-amount'); },
        half: function() { let v = parseInt(this.input.value); this.input.value = Math.max(1, Math.floor(v / 2)); sfx.click(); },
        double: function() { let v = parseInt(this.input.value); this.input.value = v * 2; sfx.click(); },
        max: function() { this.input.value = Math.floor(balance); sfx.click(); }
    };

    // --- STATE ---
    let balance = 2000;
    let lastClaim = 0;
    let usedCodes = [];

    function init() {
        if(localStorage.getItem('moon_balance')) {
            balance = parseInt(localStorage.getItem('moon_balance'));
            lastClaim = parseInt(localStorage.getItem('moon_lastClaim') || 0);
        }
        if(localStorage.getItem('moon_usedCodes')) usedCodes = JSON.parse(localStorage.getItem('moon_usedCodes'));
        updateUI(); checkFaucet(); renderGame();
    }
    function saveState() {
        localStorage.setItem('moon_balance', balance);
        localStorage.setItem('moon_lastClaim', lastClaim);
        localStorage.setItem('moon_usedCodes', JSON.stringify(usedCodes));
    }
    function updateUI() { document.getElementById('balance').innerText = balance; }
    function updateBalance(amount) { balance += amount; updateUI(); saveState(); checkFaucet(); }

    // --- ADMIN & REDEEM ---
    let adminClicks = 0, adminClickTimer;
    function triggerAdmin() { sfx.click(); adminClicks++; clearTimeout(adminClickTimer); adminClickTimer = setTimeout(() => { adminClicks = 0; }, 1000); if(adminClicks >= 5) { document.getElementById('admin-login-modal').style.display = 'flex'; adminClicks = 0; } }
    function checkAdmin() { const pass = document.getElementById('admin-pass').value; if(pass === ADMIN_PASS) { sfx.cash(); closeModal('admin-login-modal'); document.getElementById('admin-panel-modal').style.display = 'flex'; } else { showNotify("B≈ÅƒòDNY KOD", 'error'); } }
    function adminGenerateCode() { sfx.click(); const amount = parseInt(document.getElementById('admin-gen-amount').value); if(!amount || amount <= 0) return; const checkSum = ((amount * 73) + 12345).toString(36).toUpperCase(); const rand = Math.random().toString(36).substring(2,5).toUpperCase(); document.getElementById('admin-code-output').style.display = 'block'; document.getElementById('admin-code-output').innerText = `MOON-${amount}-${checkSum}-${rand}`; }
    function openRedeem() { document.getElementById('redeem-modal').style.display = 'flex'; }
    function redeemCode() { const input = document.getElementById('redeem-input').value.trim().toUpperCase(); if(!input.startsWith("MOON-")) return showNotify("B≈Çƒôdny format", 'error'); if(usedCodes.includes(input)) return showNotify("Kod u≈ºyty", 'error'); const parts = input.split('-'); if(parts.length !== 4) return showNotify("B≈ÇƒÖd kodu", 'error'); const amount = parseInt(parts[1]); if(((amount * 73) + 12345).toString(36).toUpperCase() === parts[2]) { triggerConfetti(); updateBalance(amount); usedCodes.push(input); saveState(); showNotify(`+${amount} MC`, 'success'); closeModal('redeem-modal'); } else { showNotify("Nieprawid≈Çowy kod", 'error'); } }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // --- SHOP ---
    const shopData = {
        games: [ { name: "Gra Steam (do 10 PLN)", price: 50000, desc: "Key/Gift" }, { name: "Gra Steam (do 20 PLN)", price: 90000, desc: "Key/Gift" }, { name: "Gra Steam (do 40 PLN)", price: 170000, desc: "Key/Gift" }, { name: "Gra Steam (do 60 PLN)", price: 250000, desc: "Key/Gift" }, { name: "Gra Steam (do 80 PLN)", price: 340000, desc: "Key/Gift" }, { name: "Gra Steam (do 100 PLN)", price: 420000, desc: "Key/Gift" }, { name: "Gra Steam (do 200 PLN)", price: 850000, desc: "Key/Gift" }, { name: "Gra Steam (do 300 PLN)", price: 1200000, desc: "High Tier" } ],
        gifts: [ { name: "Roblox Gamepass (80 R$)", price: 25000, desc: "Gift" }, { name: "Roblox Gamepass (400 R$)", price: 110000, desc: "Gift" }, { name: "Roblox Gamepass (800 R$)", price: 210000, desc: "Gift" }, { name: "Roblox Gamepass (1200 R$)", price: 300000, desc: "Gift" }, { name: "Roblox Gamepass (2500 R$)", price: 600000, desc: "Gift" } ],
        giftcards: [ { name: "BloxGame Card 1000", price: 40000, desc: "1000 Coins" }, { name: "BloxGame Card 2000", price: 75000, desc: "2000 Coins" } ]
    };
    let pendingItem = null;
    function openShop() { document.getElementById('shop-modal').style.display = 'flex'; filterShop('games', document.querySelector('.shop-tab')); }
    function filterShop(cat, btn) { document.querySelectorAll('.shop-tab').forEach(b => b.classList.remove('active')); (btn || document.querySelector('.shop-tab')).classList.add('active'); const c = document.getElementById('shop-container'); c.innerHTML = ''; shopData[cat].forEach(i => { c.innerHTML += `<div class="shop-card"><h3 style="margin:0; color:var(--moon-secondary); font-size:1.1rem;">${i.name}</h3><div style="font-size:0.9rem; color:#888">${i.desc}</div><div style="font-size:1.4rem; font-weight:bold; margin:5px 0">${i.price} MC</div><button class="nav-action-btn" style="width:100%; margin-top:auto;" onclick="sfx.click(); buyItem('${i.name}', ${i.price})">WYMIE≈É</button></div>`; }); }
    function buyItem(name, price) { if(balance < price) { showNotify("Brak ≈õrodk√≥w!", 'error'); return; } pendingItem = {name, price}; closeModal('shop-modal'); document.getElementById('discord-modal').style.display = 'flex'; }
    function confirmPurchase() { const nick = document.getElementById('discord-input').value; if(nick.length < 3) return showNotify("Podaj nick!", 'error'); updateBalance(-pendingItem.price); triggerConfetti(); closeModal('discord-modal'); document.getElementById('success-modal').style.display = 'flex'; fetch(WEBHOOK_URL, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ content: "üõí **NOWY ZAKUP!** @here", embeds: [{ title: "Zam√≥wienie", color: 5192959, fields: [ {name: "Discord", value: nick, inline: true}, {name: "Item", value: pendingItem.name}, {name: "Price", value: pendingItem.price + " MC"} ] }] }) }); }
    
    // --- FAUCET ---
    function checkFaucet() { const btn = document.getElementById('faucet-btn'); const t = document.getElementById('faucet-timer'); if(balance >= 1000) { btn.disabled = true; btn.innerText = "MAX"; t.innerText = "> 1000"; return; } const diff = Date.now() - lastClaim; if(diff >= 3600000) { btn.disabled = false; btn.innerText = "ODBIERZ"; t.innerText = "GOTOWE"; } else { btn.disabled = true; const l = 3600000 - diff; t.innerText = `${Math.floor((l%(1000*60*60))/(1000*60))}m ${Math.floor((l%(1000*60))/1000)}s`; setTimeout(checkFaucet, 1000); } }
    function claimFaucet() { if(balance >= 1000) return; updateBalance(100); lastClaim = Date.now(); saveState(); checkFaucet(); showNotify("Odebrano 100 MC", 'success'); }

    // --- GAME ENGINE ---
    let currentGame = 'crash', gameActive = false, gameInterval;
    function generateHash() { return Math.random().toString(36).substring(2); }
    function getBet() { const v = parseInt(document.getElementById('bet-amount').value); if(!v || v <= 0) { showNotify("Z≈Ça stawka", 'error'); return null; } if(v > balance) { showNotify("Brak ≈õrodk√≥w", 'error'); return null; } return v; }
    function switchGame(g) { if(gameActive) return showNotify("Sko≈Ñcz grƒô!", 'error'); currentGame = g; document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); event.target.classList.add('active'); renderGame(); }
    
    function renderGame() {
        const area = document.getElementById('game-area'), acts = document.getElementById('game-actions'), ext = document.getElementById('extra-controls');
        area.innerHTML = ''; acts.innerHTML = ''; ext.innerHTML = ''; document.getElementById('hash-display').innerText = "HASH: -";
        if(currentGame === 'crash') {
            area.innerHTML = `<div id="crash-multiplier">1.00x</div>`;
            acts.innerHTML = `<button class="action-btn" id="c-play" onclick="sfx.click(); playCrash()">GRAJ</button><button class="action-btn cashout-btn" id="c-out" onclick="crashOut()" disabled>WYP≈ÅAƒÜ</button>`;
        } else if (currentGame === 'mines') {
            ext.innerHTML = `<label>ILO≈öƒÜ MIN (1-24)</label><input type="number" id="mines-cnt" value="3" min="1" max="24">`;
            area.innerHTML = `<div class="mines-grid" id="mines-grid"></div><div id="mines-info" style="margin-top:15px; font-weight:bold; color:white;"></div>`;
            acts.innerHTML = `<button class="action-btn" id="m-play" onclick="sfx.click(); playMines()">GRAJ</button><button class="action-btn cashout-btn" id="m-out" onclick="minesCashout()" disabled>WYP≈ÅAƒÜ</button>`;
            initMines();
        } else if (currentGame === 'tower') {
            ext.innerHTML = `<label>TRUDNO≈öƒÜ</label>
            <select id="tower-diff" onchange="initTowerUI()">
                <option value="easy">Easy (3 pola, 2 bezpieczne)</option>
                <option value="medium">Medium (2 pola, 1 bezpieczne)</option>
                <option value="hard">Hard (3 pola, 1 bezpieczne)</option>
            </select>`;
            area.innerHTML = `<div style="display:flex; gap:10px; width:100%; justify-content:center;"><div id="tower-game" class="tower-container"></div></div>`;
            acts.innerHTML = `<button class="action-btn" id="t-play" onclick="sfx.click(); playTower()">GRAJ</button><button class="action-btn cashout-btn" id="t-out" onclick="towerCashout()" disabled>WYP≈ÅAƒÜ</button>`;
            setTimeout(initTowerUI, 0); 
        } else if (currentGame === 'limbo') {
             ext.innerHTML = `<label>CEL (x)</label><input type="number" id="limbo-target" value="2.0" step="0.1">`;
             area.innerHTML = `<div id="limbo-res" style="font-size:4rem; font-weight:bold; color:#555">0.00x</div>`;
             acts.innerHTML = `<button class="action-btn" onclick="sfx.click(); playLimbo()">GRAJ</button>`;
        } else if (currentGame === 'stocks') {
             area.innerHTML = `<canvas id="stockCanvas"></canvas><div id="stock-res" style="margin-top:10px; font-weight:bold">RYNEK ZAMKNIƒòTY</div>`;
             acts.innerHTML = `<button class="action-btn" style="background:#00f260; color:black" onclick="sfx.click(); playStocks('up')">UP ‚Üó</button><button class="action-btn" style="background:#f53b57; color:white" onclick="sfx.click(); playStocks('down')">DOWN ‚Üò</button>`;
             drawStockChart([]);
        }
    }

    // --- TOWER LOGIC ---
    let towerLevel = 0, towerMap = [];
    const towerConfigs = {
        easy: { cols: 3, safe: 2, mults: [1.42, 2.03, 2.91, 4.16, 5.95, 8.51, 12.16, 17.38, 24.83, 35.48] },
        medium: { cols: 2, safe: 1, mults: [1.94, 3.76, 7.29, 14.15, 27.45, 53.25, 103.32, 200.44, 388.86, 754.40] },
        hard: { cols: 3, safe: 1, mults: [2.91, 8.46, 24.64, 71.74, 208.91, 608.32, 1771.58, 5159.20, 15024.11, 43755.98] }
    };

    function initTowerUI() {
        if(gameActive) return; 
        const diff = document.getElementById('tower-diff').value;
        const cfg = towerConfigs[diff];
        const cont = document.getElementById('tower-game');
        if(!cont) return;
        cont.innerHTML = '';
        
        // Render rows bottom-up (0 is bottom)
        for(let r=9; r>=0; r--) {
            let row = document.createElement('div');
            row.className = 'tower-row disabled';
            row.style.gridTemplateColumns = `repeat(${cfg.cols}, 1fr)`;
            row.id = `row-${r}`;
            for(let c=0; c<cfg.cols; c++) {
                // ADD MULTIPLIER TO BUTTON TEXT
                row.innerHTML += `<div class="tower-cell" onclick="hitTower(${r}, ${c})">${cfg.mults[r]}x</div>`;
            }
            cont.appendChild(row);
        }
    }

    function playTower() {
        const bet = getBet(); if(!bet) return;
        updateBalance(-bet); gameActive = true; towerLevel = 0;
        document.getElementById('t-play').disabled = true; document.getElementById('t-out').disabled = true;
        document.getElementById('hash-display').innerText = "HASH: " + generateHash();
        
        initTowerUI(); // RE-INIT TO CLEAR

        const diff = document.getElementById('tower-diff').value;
        const cfg = towerConfigs[diff];
        
        towerMap = [];
        for(let i=0; i<10; i++) {
            let row = Array(cfg.cols).fill(1); // 1 = Safe
            let bombsPlaced = 0;
            while(bombsPlaced < (cfg.cols - cfg.safe)) {
                let rIdx = Math.floor(Math.random() * cfg.cols);
                if(row[rIdx] === 1) { row[rIdx] = 0; bombsPlaced++; }
            }
            towerMap.push(row);
        }
        renderTowerState();
    }

    function renderTowerState() {
        for(let r=0; r<10; r++) {
            const rowEl = document.getElementById(`row-${r}`);
            rowEl.classList.remove('active', 'disabled');
            if(r === towerLevel) rowEl.classList.add('active');
            else if (r > towerLevel) rowEl.classList.add('disabled');
        }
        if(towerLevel > 0) document.getElementById('t-out').disabled = false;
    }

    function hitTower(row, col) {
        if(!gameActive || row !== towerLevel) return;
        const cell = document.getElementById(`row-${row}`).children[col];
        if(towerMap[row][col] === 1) {
            sfx.click(); cell.classList.add('safe'); cell.innerText = 'üíé'; towerLevel++;
            if(towerLevel >= 10) towerCashout(); else renderTowerState();
        } else {
            sfx.lose(); cell.classList.add('boom'); cell.innerText = 'üí£'; endTower();
        }
    }

    function towerCashout() {
        if(!gameActive) return;
        const diff = document.getElementById('tower-diff').value;
        const bet = parseInt(document.getElementById('bet-amount').value);
        const mult = towerConfigs[diff].mults[towerLevel-1];
        const win = Math.floor(bet * mult);
        updateBalance(win);
        if(mult >= 10) triggerConfetti(); else sfx.win();
        showNotify(`Wygrana: ${win} MC`, 'success');
        endTower();
    }

    function endTower() {
        gameActive = false; document.getElementById('t-play').disabled = false; document.getElementById('t-out').disabled = true;
        for(let r=0; r<10; r++) {
            const rowEl = document.getElementById(`row-${r}`);
            rowEl.classList.add('disabled');
            for(let c=0; c<rowEl.children.length; c++) {
                 if(towerMap[r][c] === 0) {
                     rowEl.children[c].innerText = 'üí£';
                     if(!rowEl.children[c].classList.contains('boom')) rowEl.children[c].classList.add('revealed-gem');
                 } else if(!rowEl.children[c].classList.contains('safe')) {
                     rowEl.children[c].innerText = 'üíé'; rowEl.children[c].classList.add('revealed-gem');
                 }
            }
        }
    }

    // --- OTHER GAMES (Simplified logic kept) ---
    let crashVal=1, curMult=1;
    function playCrash() {
        const bet = getBet(); if(!bet) return;
        updateBalance(-bet); gameActive=true; document.getElementById('c-play').disabled=true; document.getElementById('c-out').disabled=false;
        crashVal=(Math.floor(100/(Math.random()*100+1)*100)/100); if(crashVal<1.01) crashVal=1.00; curMult=1.00;
        let ticks=0;
        gameInterval = setInterval(()=>{
            ticks++; if(ticks%10===0) sfx.tick();
            curMult+=0.01+(curMult*0.004);
            document.getElementById('crash-multiplier').innerText = curMult.toFixed(2)+'x';
            if(curMult>=crashVal) { clearInterval(gameInterval); sfx.lose(); document.getElementById('crash-multiplier').innerText="CRASH @ "+crashVal.toFixed(2)+"x"; document.getElementById('crash-multiplier').classList.add('crashed'); gameActive=false; document.getElementById('c-play').disabled=false; document.getElementById('c-out').disabled=true; }
        }, 50);
    }
    function crashOut() { if(!gameActive) return; clearInterval(gameInterval); const bet=parseInt(document.getElementById('bet-amount').value); updateBalance(Math.floor(bet*curMult)); if(curMult>=10) triggerConfetti(); else sfx.win(); showNotify(`Wygrana: ${Math.floor(bet*curMult)}`,'success'); gameActive=false; document.getElementById('c-play').disabled=false; document.getElementById('c-out').disabled=true; }

    let minesMap=[], revealed=0, totalMines=3;
    function initMines() { const g=document.getElementById('mines-grid'); g.innerHTML=''; for(let i=0;i<25;i++) g.innerHTML+='<div class="mine-cell" style="opacity:0.3"></div>'; }
    function playMines() {
        const bet=getBet(); if(!bet) return;
        updateBalance(-bet); totalMines=parseInt(document.getElementById('mines-cnt').value);
        if(totalMines<1 || totalMines>24) return showNotify("Miny: 1-24", 'error');
        gameActive=true; revealed=0; document.getElementById('m-play').disabled=true; document.getElementById('m-out').disabled=false;
        minesMap=Array(25).fill(false); let p=0; while(p<totalMines){let x=Math.floor(Math.random()*25); if(!minesMap[x]){minesMap[x]=true;p++;}}
        const g=document.getElementById('mines-grid'); g.innerHTML='';
        for(let i=0;i<25;i++){ let d=document.createElement('div'); d.className='mine-cell'; d.onclick=()=>hitMine(i,d); g.appendChild(d); }
    }
    function hitMine(i,el) {
        if(!gameActive||el.classList.contains('safe')) return;
        if(minesMap[i]) { el.classList.add('boom'); el.innerText='üí£'; sfx.lose(); gameActive=false; document.getElementById('m-play').disabled=false; document.getElementById('m-out').disabled=true; document.querySelectorAll('.mine-cell').forEach((c,idx)=>{if(minesMap[idx])c.innerText='üí£'}); }
        else { sfx.click(); el.classList.add('safe'); el.innerText='üíé'; revealed++; let m=1; for(let k=0;k<revealed;k++) m*=(25-k)/(25-totalMines-k); document.getElementById('mines-info').innerText=`Win: ${Math.floor(parseInt(document.getElementById('bet-amount').value)*m)} MC (${m.toFixed(2)}x)`; }
    }
    function minesCashout() { if(!gameActive) return; let m=1; for(let k=0;k<revealed;k++) m*=(25-k)/(25-totalMines-k); updateBalance(Math.floor(parseInt(document.getElementById('bet-amount').value)*m)); if(m>=10) triggerConfetti(); else sfx.win(); showNotify("Wyp≈Çacono!", 'success'); gameActive=false; document.getElementById('m-play').disabled=false; document.getElementById('m-out').disabled=true; }

    function playLimbo() {
        const bet=getBet(); if(!bet) return; const t=parseFloat(document.getElementById('limbo-target').value); if(t<=1) return showNotify("Cel > 1.0", 'error');
        updateBalance(-bet); let r=(Math.floor(100/(Math.random()*100+1)*100)/100); if(r<1.01) r=1.00;
        const el=document.getElementById('limbo-res'); el.innerText=r.toFixed(2)+'x';
        if(r>=t) { el.style.color="#00f260"; updateBalance(Math.floor(bet*t)); if(t>=10) triggerConfetti(); else sfx.win(); showNotify("Wygra≈Çe≈õ!", 'success'); } else { el.style.color="#f53b57"; sfx.lose(); }
    }

    function drawStockChart(d) { const c=document.getElementById('stockCanvas'); if(!c) return; const x=c.getContext('2d'); c.width=c.offsetWidth; c.height=c.offsetHeight; x.fillStyle="black"; x.fillRect(0,0,c.width,c.height); if(d.length<2) return; const up=d[d.length-1]>=d[0]; x.strokeStyle=up?'#00f260':'#f53b57'; x.lineWidth=3; x.beginPath(); let min=Math.min(...d), max=Math.max(...d), r=max-min||1; d.forEach((v,i)=>{ let xx=(i/(d.length-1))*c.width; let yy=c.height-((v-min)/r)*(c.height-40)-20; if(i==0) x.moveTo(xx,yy); else x.lineTo(xx,yy); }); x.stroke(); }
    function playStocks(dir) {
        if(gameActive) return; const bet=getBet(); if(!bet) return; updateBalance(-bet); gameActive=true; let p=100, h=[100], t=0;
        const i=setInterval(()=>{ p+=(Math.random()-0.5)*10; h.push(p); if(h.length>50) h.shift(); drawStockChart(h); t++; if(t>=40) { clearInterval(i); gameActive=false; const w=(dir=='up'&&h[h.length-1]>h[0])||(dir=='down'&&h[h.length-1]<h[0]); document.getElementById('stock-res').innerText=w?"WYGRANA!":"PRZEGRANA"; document.getElementById('stock-res').style.color=w?"#00f260":"#f53b57"; if(w){ sfx.win(); updateBalance(Math.floor(bet*1.9)); showNotify("Dobry strza≈Ç!", 'success'); } else sfx.lose(); } }, 50);
    }

    init();
</script>
</body>
</html>
