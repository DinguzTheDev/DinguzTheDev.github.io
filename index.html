<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOON CASINO | V32 STABLE</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --bg-deep: #050505;
            --bg-surface: #0f1219;
            --neon-accent: #00f2ff;
            --neon-glow: 0 0 10px rgba(0, 242, 255, 0.5);
            --neon-success: #00ff88;
            --neon-danger: #ff004c;
            --text-bright: #ffffff;
            --text-muted: #6b7c93;
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }

        body {
            background: radial-gradient(circle at 50% 0%, #1a2236 0%, var(--bg-deep) 100%);
            color: var(--text-bright);
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- UI UTILS --- */
        .hidden { display: none !important; }
        
        @keyframes pulse-green {
            0% { transform: scale(1); color: var(--neon-accent); }
            50% { transform: scale(1.1); color: var(--neon-success); text-shadow: 0 0 20px var(--neon-success); }
            100% { transform: scale(1); color: var(--neon-accent); }
        }
        .balance-update { animation: pulse-green 0.4s ease-out; }

        /* --- HEADER --- */
        header {
            width: 100%; padding: 15px 5%;
            background: rgba(15, 18, 25, 0.95); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: var(--glass-border); position: sticky; top: 0; z-index: 1000;
        }
        .logo { font-weight: 800; font-size: 1.8rem; cursor:pointer; letter-spacing: 2px; }
        .balance-card {
            background: rgba(0,242,255,0.05); border: 1px solid var(--neon-accent);
            padding: 8px 20px; border-radius: 8px; font-weight: 800; color: var(--neon-accent);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.1); transition: 0.3s;
        }

        /* --- BUTTONS & INPUTS --- */
        .btn-neon {
            background: var(--neon-accent); color: #000; border: none;
            padding: 12px 24px; border-radius: 6px; font-weight: 700;
            text-transform: uppercase; cursor: pointer; transition: 0.2s;
            box-shadow: 0 4px 15px rgba(0, 242, 255, 0.2);
        }
        .btn-neon:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 242, 255, 0.4); }
        .btn-neon:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; transform:none; }
        
        .btn-secondary { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 10px 20px; border-radius: 6px; cursor: pointer; transition:0.2s;}
        .btn-secondary:hover:not(:disabled) { background: rgba(255,255,255,0.1); border-color: #fff; }
        .btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }

        input, select {
            background: #0a0d14; border: 1px solid #333;
            color: var(--neon-accent); padding: 12px 15px; border-radius: 6px;
            font-family: inherit; font-size: 1.1rem; font-weight: 600; width: 100%;
            transition: 0.3s;
        }
        input:focus, select:focus { outline: none; border-color: var(--neon-accent); box-shadow: var(--neon-glow); }
        input:disabled, select:disabled { opacity: 0.5; cursor: not-allowed; }

        /* --- GAME GRID --- */
        #main-menu { width: 100%; max-width: 1200px; padding: 40px 20px; }
        .game-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .game-card {
            background: var(--bg-surface); border: var(--glass-border); border-radius: 15px;
            padding: 20px; cursor: pointer; transition: 0.3s; display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .game-card:hover { transform: translateY(-5px); border-color: var(--neon-accent); box-shadow: var(--neon-glow); }
        .game-icon { font-size: 3rem; margin-bottom: 10px; }

        /* --- GAME VIEW --- */
        #game-view { width: 100%; max-width: 900px; padding: 30px 20px; }
        .game-frame { background: var(--bg-surface); padding: 30px; border-radius: 20px; border: var(--glass-border); position: relative; }
        #game-area { min-height: 300px; display: flex; justify-content: center; align-items: center; flex-direction: column; margin-bottom: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; border: 1px solid rgba(255,255,255,0.05); padding: 20px; position: relative; overflow: hidden; }

        /* --- CRASH --- */
        #crash-mult { font-size: 5rem; font-weight: 800; z-index: 10; transition: color 0.2s; color:white; }
        .rocket-container { position: absolute; bottom: 20px; transition: bottom 0.1s linear; display: flex; flex-direction: column; align-items: center; }
        .rocket-emoji { font-size: 4rem; filter: drop-shadow(0 0 10px var(--neon-accent)); }
        .rocket-flame { width: 10px; height: 30px; background: orange; border-radius: 50%; filter: blur(4px); opacity: 0; transition: opacity 0.2s; }

        /* --- MINES --- */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .mine-cell { width: 60px; height: 60px; background: #222; border-radius: 8px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 2rem; transition: 0.2s; border: 1px solid #333; }
        .mine-cell:hover:not(.revealed) { background: #333; border-color: var(--neon-accent); }
        .mine-cell.safe { background: rgba(0, 255, 136, 0.2); border-color: var(--neon-success); }
        .mine-cell.bomb { background: rgba(255, 0, 76, 0.2); border-color: var(--neon-danger); }

        /* --- ROULETTE --- */
        .roulette-container { overflow: hidden; width: 100%; height: 100px; background: #000; border: 2px solid var(--neon-accent); border-radius: 8px; position: relative; }
        .roulette-track { display: flex; height: 100%; align-items: center; }
        .r-card { min-width: 80px; height: 80px; margin: 0 2px; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 1.2rem; color: white; }
        .bg-red { background: var(--neon-danger); } .bg-black { background: #222; } .bg-green { background: var(--neon-success); }
        .selector { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: #fff; transform: translateX(-50%); z-index: 10; box-shadow: 0 0 10px white; }

        /* --- BLACKJACK --- */
        .bj-table { width: 100%; display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .hand { display: flex; gap: 5px; min-height: 100px; justify-content: center; }
        .card { width: 70px; height: 100px; background: white; border-radius: 6px; color: black; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding:5px; font-weight: bold; font-size: 1.2rem; box-shadow: 0 5px 15px rgba(0,0,0,0.5); position: relative; }
        .card.red { color: red; }
        .card-corner { align-self: flex-start; font-size: 0.8rem; line-height: 1; }
        .card-center { font-size: 2rem; }
        .card-corner.bottom { align-self: flex-end; transform: rotate(180deg); }

        /* --- PLINKO --- */
        .plinko-board { position: relative; width: 400px; height: 320px; background: #111; overflow: hidden; border-radius: 10px; border: 1px solid #333; }
        .peg { position: absolute; width: 6px; height: 6px; background: #555; border-radius: 50%; box-shadow: 0 0 2px #555; }
        .plinko-ball { position: absolute; width: 10px; height: 10px; background: var(--neon-accent); border-radius: 50%; box-shadow: 0 0 8px var(--neon-accent); z-index:10; pointer-events: none; }
        .bucket-row { position: absolute; bottom: 0; width: 100%; display: flex; height: 30px; }
        .bucket { flex: 1; display: flex; justify-content: center; align-items: center; font-size: 0.6rem; color: #fff; border-top: 1px solid #333; border-right: 1px solid #222; }

        /* --- CROSSY ROAD --- */
        .cross-container { display: flex; flex-direction: column-reverse; gap: 5px; width: 100%; max-width: 400px; }
        .lane { display: flex; height: 50px; background: #222; border-bottom: 2px dashed #444; position: relative; align-items: center; justify-content: center; overflow: hidden; border-radius: 6px; }
        .chicken { font-size: 2rem; z-index: 10; position: relative; }
        .car { position: absolute; font-size: 2rem; top: 0; transition: left 0.3s linear; }
        
        /* --- CUPS --- */
        .cups-wrapper { display: flex; gap: 30px; margin-top: 50px; position: relative; }
        .cup { width: 80px; height: 100px; background: linear-gradient(135deg, #e0e0e0, #fff); clip-path: polygon(15% 0, 85% 0, 100% 100%, 0% 100%); cursor: pointer; transition: transform 0.3s; position: relative; z-index: 5; border-bottom: 5px solid #ccc; }
        .cup:hover { transform: translateY(-5px); }
        .cup-ball { width: 25px; height: 25px; background: var(--neon-accent); border-radius: 50%; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); display: none; box-shadow: 0 0 15px var(--neon-accent); z-index: 1; }

        /* --- LOOTBOXES --- */
        .loot-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; }
        .loot-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; border: 1px solid transparent; transition: 0.3s; }
        .loot-card:hover { border-color: var(--neon-accent); transform: scale(1.02); }
        .loot-img { font-size: 3rem; margin-bottom: 10px; }
        .loot-card.bronze { border-bottom: 3px solid #cd7f32; }
        .loot-card.silver { border-bottom: 3px solid #c0c0c0; }
        .loot-card.gold { border-bottom: 3px solid #ffd700; }
        .loot-card.diamond { border-bottom: 3px solid #00f2ff; }

        /* --- NOTIFY --- */
        #notify { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); z-index: 20000; padding: 15px 40px; border-radius: 12px; font-weight: 800; display: none; background: #fff; color: #000; box-shadow: 0 0 30px rgba(255,255,255,0.3); }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9000; display: none; justify-content: center; align-items: center; }
        .modal-box { background: #0f1219; border: 1px solid var(--neon-accent); padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; }
    </style>
</head>
<body onclick="sfx.init()">

<div id="notify"></div>
<canvas id="confetti-canvas" style="position:fixed;inset:0;pointer-events:none;z-index:8000"></canvas>

<header>
    <div class="logo" onclick="showHub()">MOON<span style="color:var(--neon-accent)">CASINO</span></div>
    <div style="display:flex; align-items:center; gap:15px;">
        <div class="balance-card"><span id="balance">0</span> MC</div>
        <button class="btn-secondary" onclick="openShop()">SKLEP</button>
    </div>
</header>

<div id="main-menu">
    <div class="game-grid">
        <div class="game-card" onclick="switchGame('crash')"><div class="game-icon">üöÄ</div><h3>Crash</h3></div>
        <div class="game-card" onclick="switchGame('mines')"><div class="game-icon">üíé</div><h3>Mines</h3></div>
        <div class="game-card" onclick="switchGame('roulette')"><div class="game-icon">üé°</div><h3>Roulette</h3></div>
        <div class="game-card" onclick="switchGame('blackjack')"><div class="game-icon">üÉè</div><h3>Blackjack</h3></div>
        <div class="game-card" onclick="switchGame('plinko')"><div class="game-icon">üîΩ</div><h3>Plinko</h3></div>
        <div class="game-card" onclick="switchGame('cross')"><div class="game-icon">üêî</div><h3>Crossy</h3></div>
        <div class="game-card" onclick="switchGame('cups')"><div class="game-icon">ü•§</div><h3>Cups</h3></div>
        <div class="game-card" onclick="switchGame('keno')"><div class="game-icon">üî¢</div><h3>Keno</h3></div>
        <div class="game-card" onclick="switchGame('lootbox')"><div class="game-icon">üì¶</div><h3>Lootbox</h3></div>
        <div class="game-card" onclick="switchGame('limbo')"><div class="game-icon">üìà</div><h3>Limbo</h3></div>
    </div>
</div>

<div id="game-view" class="hidden">
    <button class="btn-secondary" style="margin-bottom:20px;" onclick="showHub()">‚Üê MENU</button>
    
    <div class="game-frame">
        <div style="display:flex; gap:15px; margin-bottom:20px;">
            <div style="flex:1;">
                <label style="color:#777; font-size:0.8rem; font-weight:bold;">STAWKA</label>
                <div style="display:flex; gap:2px;">
                    <input type="number" id="bet-amount" value="100" style="border-radius:6px 0 0 6px;">
                    <button class="btn-secondary bet-ctrl" onclick="betUtils.half()" style="border-radius:0;">¬Ω</button>
                    <button class="btn-secondary bet-ctrl" onclick="betUtils.double()" style="border-radius:0;">x2</button>
                    <button class="btn-secondary bet-ctrl" onclick="betUtils.max()" style="border-radius:0 6px 6px 0;">MAX</button>
                </div>
            </div>
            <div id="extra-controls" style="flex:1;"></div>
        </div>

        <div id="game-area"></div>
        <div id="game-actions" style="margin-top:20px;"></div>
    </div>
</div>

<div id="shop-view" class="hidden" style="width:100%; max-width:1200px; padding:40px;">
    <h2 style="margin-bottom:20px;">SKLEP</h2>
    <div id="shop-grid" class="game-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));"></div>
    <button class="btn-secondary" style="margin-top:30px;" onclick="showHub()">WR√ìƒÜ</button>
</div>

<div id="redeem-modal" class="modal-overlay">
    <div class="modal-box">
        <h3>REALIZACJA KODU</h3>
        <input id="redeem-code" placeholder="Wpisz kod..." style="margin:15px 0;">
        <button class="btn-neon" style="width:100%" onclick="redeemCode()">ODBIERZ</button>
        <button class="btn-secondary" style="width:100%; margin-top:10px;" onclick="closeModal('redeem-modal')">ANULUJ</button>
    </div>
</div>

<div id="admin-modal" class="modal-overlay">
    <div class="modal-box">
        <h3>ADMIN PANEL</h3>
        <input id="admin-pass" type="password" placeholder="Has≈Ço" style="margin-bottom:10px;">
        <button class="btn-neon" onclick="checkAdmin()">ZALOGUJ</button>
        <div id="admin-tools" class="hidden" style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
            <input id="announce-text" placeholder="Og≈Çoszenie"><button class="btn-secondary" onclick="sendAnnounce()">Wy≈õlij</button>
            <input id="wipe-id" placeholder="ID Gracza"><button class="btn-secondary" style="color:red;border-color:red" onclick="sendWipe()">WIPE</button>
            <input id="gen-amount" type="number" placeholder="Kwota kodu"><button class="btn-secondary" onclick="genCode()">Generuj</button>
            <div id="code-res" style="color:lime; font-family:monospace; margin-top:5px;"></div>
        </div>
        <button class="btn-secondary" style="width:100%; margin-top:10px;" onclick="closeModal('admin-modal')">ZAMKNIJ</button>
    </div>
</div>

<footer onclick="openAdmin()" style="margin-top:auto; padding:20px; color:#333; font-size:0.7rem;">ID: <span id="uid"></span></footer>

<script>
    // --- SETUP ---
    const firebaseConfig = { apiKey: "AIzaSyDJDQU7KDdUfhir0zU3qDZw9o7G8ZMjkYM", authDomain: "dinguzcasino.firebaseapp.com", databaseURL: "https://dinguzcasino-default-rtdb.europe-west1.firebasedatabase.app", projectId: "dinguzcasino", storageBucket: "dinguzcasino.firebasestorage.app", messagingSenderId: "852367818280", appId: "1:852367818280:web:d028016fe2b75ae63f7f1d" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const WEBHOOK = "https://discord.com/api/webhooks/1452455171723366533/AXVryGu8apz0R-Gr8jBP3EOCiPweO87OuLlo6qUkmqVipABBHfIwCd7mKt131JaXbhkR";
    const ADMIN_PASS = "amimir123";

    const shopItems = [
        { name: "Robux 800", price: 250000, img: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Roblox_player_icon_black.svg/1200px-Roblox_player_icon_black.svg.png" },
        { name: "Steam 60 PLN", price: 450000, img: "https://cdn-icons-png.flaticon.com/512/220/220223.png" },
        { name: "Xbox Game Pass", price: 550000, img: "https://cms-assets.xboxservices.com/assets/d1/3c/d13c81f4-48c4-429e-b630-23bc1a2e913c.svg" },
        { name: "Kamerka BLOW", price: 800000, img: "https://i.ibb.co/Ngfyr4nJ/image-removebg-preview-57.png" },
        { name: "Mata MIMIMIMI", price: 700000, img: "https://i.ibb.co/6K8wTcB/image.png" },
        { name: "MEGA SIGMA BLOWER", price: 1500000, img: "https://i.ibb.co/tMwrTRmR/image.png" }
    ];

    let balance = 2000, userID = "", gameActive = false, currentGame = "";
    let usedCodes = [];

    function init() {
        balance = parseInt(localStorage.getItem('moon_balance') || 2000);
        userID = localStorage.getItem('moon_uid') || Math.random().toString(36).substr(2,7).toUpperCase();
        localStorage.setItem('moon_uid', userID);
        document.getElementById('uid').innerText = userID;
        updateUI();
        
        db.ref('system/wipe').on('child_added', s => { 
            if(s.val().target === userID && Date.now() - s.val().ts < 60000) { 
                balance = 0; updateBalance(0); alert("KONTO WYZEROWANE PRZEZ ADMINA"); location.reload();
            } 
        });
        db.ref('system/announce').on('value', s => {
            if(s.val() && Date.now() - s.val().ts < 10000) notify(s.val().text, "info");
        });
    }

    // --- NAVIGATION ---
    function showHub() { if(gameActive) return notify("Doko≈Ñcz grƒô!", "error"); setView('menu'); }
    function switchGame(g) { if(gameActive) return notify("Doko≈Ñcz grƒô!", "error"); currentGame=g; setView('game'); renderGame(); }
    function openShop() { if(gameActive) return notify("Doko≈Ñcz grƒô!", "error"); setView('shop'); renderShop(); }
    function setView(v) {
        document.getElementById('main-menu').classList.add('hidden');
        document.getElementById('game-view').classList.add('hidden');
        document.getElementById('shop-view').classList.add('hidden');
        if(v==='menu') document.getElementById('main-menu').classList.remove('hidden');
        if(v==='game') document.getElementById('game-view').classList.remove('hidden');
        if(v==='shop') document.getElementById('shop-view').classList.remove('hidden');
    }

    // --- RENDER GAME ---
    function renderGame() {
        const area = document.getElementById('game-area');
        const acts = document.getElementById('game-actions');
        const extra = document.getElementById('extra-controls');
        area.innerHTML = ''; acts.innerHTML = ''; extra.innerHTML = '';

        if(currentGame === 'crash') {
            area.innerHTML = `<div id="crash-scene" style="width:100%;height:300px;position:relative;overflow:hidden;"><div id="crash-mult" style="font-size:5rem;color:white;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:800;z-index:10;">1.00x</div><div class="rocket-container" id="rocket"><div class="rocket-emoji">üöÄ</div><div class="rocket-flame" id="flame"></div></div></div>`;
            acts.innerHTML = `<button class="btn-neon" style="width:100%" onclick="playCrash()">START</button>`;
        }
        else if(currentGame === 'mines') {
            extra.innerHTML = `<label style="color:#aaa;font-size:0.8rem;">MINY</label><input type="number" id="mines-cnt" value="3" max="24">`;
            area.innerHTML = `<div class="mines-grid" id="mines-grid"></div>`;
            for(let i=0;i<25;i++) document.getElementById('mines-grid').innerHTML += `<div class="mine-cell" onclick="hitMine(${i}, this)"></div>`;
            acts.innerHTML = `<button class="btn-neon" style="width:100%" onclick="playMines()">GRAJ</button>`;
        }
        else if(currentGame === 'roulette') {
            area.innerHTML = `<div class="roulette-container"><div class="selector"></div><div class="roulette-track" id="r-track"></div></div>`;
            extra.innerHTML = `<div style="display:flex;gap:5px;"><button class="btn-secondary" onclick="rBet='red';notify('RED')" style="background:var(--neon-danger)">RED (2x)</button><button class="btn-secondary" onclick="rBet='black';notify('BLACK')" style="background:#222">BLACK (2x)</button><button class="btn-secondary" onclick="rBet='green';notify('GREEN')" style="background:var(--neon-success)">GREEN (14x)</button></div>`;
            acts.innerHTML = `<button class="btn-neon" style="width:100%" id="spin-btn" onclick="playRoulette()">SPIN</button>`;
            initRoulette();
        }
        else if(currentGame === 'blackjack') {
            area.innerHTML = `<div class="bj-table"><div class="hand" id="dl-hand"></div><div style="font-weight:bold">DEALER</div><div class="hand" id="pl-hand"></div><div style="font-weight:bold">YOU</div></div>`;
            acts.innerHTML = `<button class="btn-neon" style="width:100%" onclick="playBlackjack()">ROZDAJ</button>`;
        }
        else if(currentGame === 'plinko') {
            extra.innerHTML = `<select id="plinko-rows"><option value="8">8 Rzƒôd√≥w</option><option value="12" selected>12 Rzƒôd√≥w</option><option value="16">16 Rzƒôd√≥w</option></select><select id="plinko-risk"><option value="low">Niskie</option><option value="med" selected>≈örednie</option><option value="high">Wysokie</option></select>`;
            area.innerHTML = `<div class="plinko-board" id="plinko-board"><div class="bucket-row" id="plinko-buckets"></div></div>`;
            initPlinko();
            acts.innerHTML = `<button class="btn-neon" style="width:100%" onclick="dropPlinko()">DROP</button>`;
        }
        else if(currentGame === 'cross') {
            area.innerHTML = `<div id="cross-road" class="cross-container"></div>`;
            acts.innerHTML = `<button class="btn-neon" style="width:100%" onclick="playCross()">START RUN</button>`;
        }
        else if(currentGame === 'cups') {
            area.innerHTML = `<div class="cups-wrapper"><div class="cup" id="cup0" onclick="pickCup(0)"></div><div class="cup" id="cup1" onclick="pickCup(1)"></div><div class="cup" id="cup2" onclick="pickCup(2)"></div><div class="cup-ball" id="cup-ball"></div></div>`;
            acts.innerHTML = `<button class="btn-neon" style="width:100%" onclick="playCups()">TASUJ</button>`;
        }
        else if(currentGame === 'keno') {
            area.innerHTML = `<div style="display:grid;grid-template-columns:repeat(8,1fr);gap:5px;max-width:400px;" id="keno-board"></div>`;
            for(let i=1;i<=40;i++) document.getElementById('keno-board').innerHTML+=`<div class="mine-cell" style="font-size:1rem;" onclick="toggleKeno(${i},this)">${i}</div>`;
            acts.innerHTML = `<button class="btn-neon" style="width:100%" onclick="playKeno()">LOSUJ</button>`;
        }
        else if(currentGame === 'limbo') { renderSimple('limbo'); }
        else if(currentGame === 'lootbox') { renderSimple('lootbox'); }
    }

    function renderSimple(t) {
        const a = document.getElementById('game-area'), ac = document.getElementById('game-actions'), ex = document.getElementById('extra-controls');
        if(t==='limbo'){
            ex.innerHTML = `<label style="color:#aaa;">CEL</label><input id="limbo-t" value="2.0">`;
            a.innerHTML = `<div id="limbo-res" style="font-size:4rem;font-weight:800;color:white;">0.00x</div>`;
            ac.innerHTML = `<button class="btn-neon" style="width:100%" onclick="playLimbo()">GRAJ</button>`;
        }
        if(t==='lootbox'){
            a.innerHTML = `<div class="loot-grid" id="loot-grid">
                <div class="loot-card bronze" onclick="openBox('bronze', 500)"><div class="loot-img">üì¶</div><h3>BRONZE</h3><p>500 MC</p></div>
                <div class="loot-card silver" onclick="openBox('silver', 5000)"><div class="loot-img">üíº</div><h3>SILVER</h3><p>5,000 MC</p></div>
                <div class="loot-card gold" onclick="openBox('gold', 50000)"><div class="loot-img">üëë</div><h3>GOLD</h3><p>50,000 MC</p></div>
                <div class="loot-card diamond" onclick="openBox('diamond', 500000)"><div class="loot-img">üíé</div><h3>DIAMOND</h3><p>500,000 MC</p></div>
            </div>
            <div id="loot-res" style="display:none;font-size:2rem;color:var(--neon-success);margin-top:20px;font-weight:bold;"></div>`;
            ac.innerHTML = '';
        }
    }

    // --- CRASH ---
    let cm=1, cInt;
    function playCrash() {
        const bet = getBet(); if(!bet) return;
        updateBalance(-bet); gameActive=true; lock(true); cm=1;
        
        // RESET EXPLOSION
        const rc = document.getElementById('rocket');
        rc.innerHTML = '<div class="rocket-emoji">üöÄ</div><div class="rocket-flame" id="flame" style="opacity:1"></div>';
        document.getElementById('crash-mult').style.color = "white";
        document.getElementById('crash-mult').innerText = "1.00x";
        
        let crashAt = (Math.floor(96/(Math.random()*100+0.1)*100)/100); if(crashAt<1.01) crashAt=1.00;
        document.getElementById('game-actions').innerHTML = `<button class="btn-neon" style="background:var(--neon-success);width:100%" onclick="crashOut()">WYP≈ÅAƒÜ</button>`;
        
        cInt = setInterval(()=>{
            cm+=0.01+(cm*0.004); document.getElementById('crash-mult').innerText=cm.toFixed(2)+'x';
            rc.style.bottom = Math.min(250, (cm-1)*50 + 20) + 'px';
            if(cm>=crashAt) {
                clearInterval(cInt); sfx.lose(); document.getElementById('crash-mult').innerText="CRASH"; document.getElementById('crash-mult').style.color="var(--neon-danger)"; 
                rc.innerHTML='<div style="font-size:4rem">üí•</div>'; 
                gameActive=false; lock(false); 
                document.getElementById('game-actions').innerHTML = `<button class="btn-neon" style="width:100%" onclick="playCrash()">GRAJ</button>`;
            }
        }, 50);
    }
    function crashOut() {
        if(!gameActive) return; clearInterval(cInt);
        const bet = parseInt(document.getElementById('bet-amount').value);
        updateBalance(Math.floor(bet*cm)); sfx.win(); notify("Wygrana: "+fmt(Math.floor(bet*cm)));
        gameActive=false; lock(false);
        document.getElementById('game-actions').innerHTML = `<button class="btn-neon" style="width:100%" onclick="playCrash()">GRAJ</button>`;
    }

    // --- MINES ---
    let mines=[], rev=0, mc=3;
    function playMines() {
        const bet=getBet(); if(!bet) return;
        updateBalance(-bet); gameActive=true; lock(true); rev=0; mc=parseInt(document.getElementById('mines-cnt').value);
        mines=Array(25).fill(0); let p=0; while(p<mc){let r=Math.floor(Math.random()*25);if(!mines[r]){mines[r]=1;p++;}}
        renderGame(); // Clear grid
        document.getElementById('game-actions').innerHTML = `<button class="btn-neon" style="background:var(--neon-success);width:100%" onclick="minesCash()" disabled id="m-cash">WYP≈ÅAƒÜ</button>`;
    }
    function hitMine(i, el) {
        if(!gameActive || el.classList.contains('revealed')) return;
        el.classList.add('revealed');
        if(mines[i]) {
            el.innerHTML="üí£"; el.classList.add('bomb'); sfx.lose(); 
            gameActive=false; lock(false); 
            document.querySelectorAll('.mine-cell').forEach((c,x)=>{if(mines[x]){c.innerHTML="üí£";c.classList.add('bomb');}});
            document.getElementById('game-actions').innerHTML = `<button class="btn-neon" style="width:100%" onclick="playMines()">GRAJ</button>`;
        } else {
            el.innerHTML="üíé"; el.classList.add('safe'); rev++; sfx.win();
            let m=1; for(let k=0;k<rev;k++) m*=(25-k)/(25-mc-k); m*=0.95;
            document.getElementById('m-cash').innerText=`WYP≈ÅAƒÜ (${m.toFixed(2)}x)`;
            document.getElementById('m-cash').disabled=false;
        }
    }
    function minesCash() {
        let m=1; for(let k=0;k<rev;k++) m*=(25-k)/(25-mc-k); m*=0.95;
        updateBalance(Math.floor(parseInt(document.getElementById('bet-amount').value)*m)); sfx.cash(); 
        gameActive=false; lock(false); renderGame();
    }

    // --- ROULETTE ---
    let rBet = null;
    function initRoulette() { const t=document.getElementById('r-track'); t.innerHTML=''; for(let i=0;i<50;i++){ let n=Math.floor(Math.random()*15); let c=n===0?'green':(n%2===0?'red':'black'); t.innerHTML+=`<div class="r-card bg-${c}">${n}</div>`; } }
    function playRoulette() {
        if(gameActive) return; 
        const bet=getBet(); if(!bet || !rBet) return notify("Wybierz kolor!");
        updateBalance(-bet); gameActive=true; lock(true); document.getElementById('spin-btn').disabled=true;
        const track=document.getElementById('r-track');
        track.style.transition = "transform 4s cubic-bezier(0.1, 0.9, 0.2, 1)";
        track.style.transform = "translateX(-2000px)";
        
        setTimeout(()=>{
            track.style.transition='none'; track.style.transform='translateX(0)';
            const winNum = Math.floor(Math.random()*15);
            const winCol = winNum===0?'green':(winNum%2===0?'red':'black');
            track.innerHTML = `<div class="r-card bg-${winCol}" style="width:100%; font-size:3rem;">${winNum}</div>`;
            
            if(rBet===winCol) { updateBalance(bet*(winCol==='green'?14:2)); sfx.win(); notify("WYGRANA!"); } else sfx.lose();
            gameActive=false; lock(false); document.getElementById('spin-btn').disabled=false; setTimeout(initRoulette,2000);
        }, 4000);
    }

    // --- BLACKJACK ---
    let deck=[], ph=[], dh=[];
    function playBlackjack() {
        const bet=getBet(); if(!bet) return;
        updateBalance(-bet); gameActive=true; lock(true);
        deck=makeDeck(); ph=[draw(),draw()]; dh=[draw(),draw()];
        renderBJ(true);
        document.getElementById('game-actions').innerHTML = `<button class="btn-neon" onclick="bjHit()">HIT</button><button class="btn-neon" onclick="bjStand()">STAND</button>`;
        if(calcBJ(ph)===21) bjStand();
    }
    function makeDeck(){ let s=['H','D','C','S'], r=['2','3','4','5','6','7','8','9','10','J','Q','K','A'], d=[]; s.forEach(x=>r.forEach(y=>d.push({s:x,r:y}))); return d.sort(()=>Math.random()-0.5); }
    function draw(){ return deck.pop(); }
    function calcBJ(h){ let sum=0, aces=0; h.forEach(c=>{if(c.r==='A')aces++; else if(['J','Q','K'].includes(c.r))sum+=10; else sum+=parseInt(c.r);}); for(let i=0;i<aces;i++) sum+=11; while(sum>21 && aces>0){sum-=10;aces--;} return sum; }
    function renderBJ(hide) {
        const pc = document.getElementById('pl-hand'), dc = document.getElementById('dl-hand');
        pc.innerHTML = ph.map(c=>cardHTML(c)).join('');
        dc.innerHTML = hide ? cardHTML(dh[0])+`<div class="card" style="background:#222;border:1px solid #444;justify-content:center;">?</div>` : dh.map(c=>cardHTML(c)).join('');
    }
    function cardHTML(c) { return `<div class="card ${['H','D'].includes(c.s)?'red':''}"><span class="card-corner">${c.r}</span><span class="card-center">${c.s==='H'?'‚ô•':c.s==='D'?'‚ô¶':c.s==='C'?'‚ô£':'‚ô†'}</span><span class="card-corner bottom">${c.r}</span></div>`; }
    function bjHit() { ph.push(draw()); renderBJ(true); if(calcBJ(ph)>21) endBJ(false); }
    function bjStand() { while(calcBJ(dh)<17) dh.push(draw()); renderBJ(false); let p=calcBJ(ph), d=calcBJ(dh); if(d>21||p>d) endBJ(true); else if(p===d) endBJ(null); else endBJ(false); }
    function endBJ(w) {
        if(w===true){ updateBalance(parseInt(document.getElementById('bet-amount').value)*2); sfx.win(); notify("WYGRANA!"); }
        else if(w===false){ sfx.lose(); notify("PRZEGRANA"); }
        else { updateBalance(parseInt(document.getElementById('bet-amount').value)); notify("REMIS"); }
        gameActive=false; lock(false);
        document.getElementById('game-actions').innerHTML = `<button class="btn-neon" style="width:100%" onclick="playBlackjack()">ROZDAJ PONOWNIE</button>`;
    }

    // --- PLINKO ---
    function initPlinko() {
        const rows = parseInt(document.getElementById('plinko-rows').value);
        const b = document.getElementById('plinko-board'); b.innerHTML = '';
        const buckets = document.getElementById('plinko-buckets'); buckets.innerHTML='';
        for(let r=0; r<rows; r++) { for(let c=0; c<=r; c++) { let p=document.createElement('div'); p.className='peg'; p.style.top=(r*25+30)+'px'; p.style.left=(200-r*10+c*20)+'px'; b.appendChild(p); } }
        // Buckets logic
        let mults=[]; 
        if(document.getElementById('plinko-risk').value==='high') { for(let i=0;i<=rows;i++) mults.push(i===0||i===rows? 20 : (i===1||i===rows-1 ? 5 : 0.2)); } 
        else mults=Array(rows+1).fill(0).map((_,i)=>Math.abs(i-rows/2)>rows/3 ? 3 : 0.5);
        mults.forEach(m=>buckets.innerHTML+=`<div class="bucket">${m}x</div>`);
    }
    function dropPlinko() {
        const bet=getBet(); if(!bet) return;
        updateBalance(-bet);
        const rows = parseInt(document.getElementById('plinko-rows').value);
        const ball = document.createElement('div'); ball.className='plinko-ball';
        document.getElementById('plinko-board').appendChild(ball);
        let r=0, x=200, path=[]; for(let i=0;i<rows;i++) path.push(Math.random()>0.5?1:-1);
        let int = setInterval(()=>{
            if(r >= rows) {
                clearInterval(int); ball.remove();
                let endX = Math.floor((x - (200 - rows*10)) / 20);
                if(endX<0) endX=0; if(endX>rows) endX=rows;
                const m = parseFloat(document.querySelectorAll('.bucket')[endX].innerText.replace('x',''));
                updateBalance(Math.floor(bet*m)); if(m>1) sfx.win();
            } else {
                r++; x+=path[r-1]*10; ball.style.top=(r*25+30)+'px'; ball.style.left=x+'px';
            }
        }, 80);
    }

    // --- CROSSY ROAD ---
    let crLvl=0;
    function playCross() {
        const bet=getBet(); if(!bet) return;
        updateBalance(-bet); gameActive=true; lock(true); crLvl=0;
        const b = document.getElementById('cross-road'); b.innerHTML='';
        for(let i=0;i<8;i++) b.innerHTML += `<div class="lane" id="ln-${i}"><div class="chicken" style="display:none">üêî</div><button class="btn-neon finish-line" onclick="crossStep(${i})">SKOK</button></div>`;
        updateCrossUI();
        document.getElementById('game-actions').innerHTML = `<button class="btn-neon" style="background:var(--neon-success)" onclick="crossCash()" disabled id="cr-cash">WYP≈ÅAƒÜ</button>`;
    }
    function updateCrossUI() {
        for(let i=0;i<8;i++) {
            const l = document.getElementById(`ln-${i}`);
            if(i===crLvl) { l.querySelector('button').style.display='block'; l.querySelector('.chicken').style.display='block'; }
            else { l.querySelector('button').style.display='none'; l.querySelector('.chicken').style.display='none'; }
        }
    }
    function crossStep(lvl) {
        if(lvl!==crLvl) return;
        const lane = document.getElementById(`ln-${lvl}`);
        // Car logic: Easy at start, harder later
        let dieChance = 0.1 + (lvl * 0.08); // 10% -> 66%
        if(Math.random() < dieChance) {
            lane.innerHTML += `<div class="car" style="left:0">üöó</div>`;
            setTimeout(()=>lane.querySelector('.car').style.left='100%', 10);
            setTimeout(()=>{ sfx.lose(); notify("BUM!", "error"); gameActive=false; lock(false); document.getElementById('game-actions').innerHTML=`<button class="btn-neon" style="width:100%" onclick="playCross()">AGAIN</button>`; }, 300);
        } else {
            sfx.win(); crLvl++; 
            if(crLvl>=8) crossCash(); 
            else { updateCrossUI(); document.getElementById('cr-cash').disabled=false; document.getElementById('cr-cash').innerText=`WYP≈ÅAƒÜ (${Math.pow(1.5, crLvl).toFixed(2)}x)`; }
        }
    }
    function crossCash() {
        let m = Math.pow(1.5, crLvl); updateBalance(Math.floor(parseInt(document.getElementById('bet-amount').value)*m)); sfx.cash(); gameActive=false; lock(false); renderGame();
    }

    // --- CUPS ---
    function playCups() {
        const bet=getBet(); if(!bet) return;
        updateBalance(-bet); gameActive=true; lock(true);
        document.getElementById('cup-ball').style.display='none';
        // Anim
        [0,1,2].forEach(i=>document.getElementById(`cup${i}`).style.transform='translateY(-30px)');
        setTimeout(()=>{
            [0,1,2].forEach(i=>document.getElementById(`cup${i}`).style.transform='translateY(0)');
        }, 500);
    }
    function pickCup(i) {
        if(!gameActive) return;
        const win = Math.floor(Math.random()*3);
        const ball = document.getElementById('cup-ball');
        ball.style.display='block';
        ball.style.left = (document.getElementById(`cup${win}`).offsetLeft + 30) + 'px';
        document.getElementById(`cup${i}`).style.transform = 'translateY(-50px)';
        
        if(i===win) { updateBalance(parseInt(document.getElementById('bet-amount').value)*2.9); sfx.win(); notify("TRAFIONY!"); }
        else sfx.lose();
        gameActive=false; lock(false);
    }

    // --- KENO ---
    let kenoSel = [];
    function toggleKeno(n, el) {
        if(gameActive) return;
        if(kenoSel.includes(n)) { kenoSel=kenoSel.filter(x=>x!==n); el.style.background='rgba(255,255,255,0.05)'; }
        else { if(kenoSel.length<10){ kenoSel.push(n); el.style.background='var(--neon-accent)'; } }
    }
    function playKeno() {
        const bet=getBet(); if(!bet || kenoSel.length===0) return notify("Wybierz liczby!");
        updateBalance(-bet); gameActive=true; lock(true);
        let hits=0, draws=[];
        while(draws.length<10) { let r=Math.ceil(Math.random()*40); if(!draws.includes(r)) draws.push(r); }
        
        // Reset old highlights
        document.querySelectorAll('#keno-board .mine-cell').forEach(c=>{ if(!kenoSel.includes(parseInt(c.innerText))) c.style.background='rgba(255,255,255,0.05)'; });

        const cells = document.querySelectorAll('#keno-board .mine-cell');
        draws.forEach((d, i) => {
            setTimeout(()=>{
                let el = cells[d-1];
                if(kenoSel.includes(d)) { el.style.background='var(--neon-success)'; hits++; sfx.win(); }
                else el.style.background='var(--neon-danger)';
                
                if(i===9) {
                    if(hits>0) updateBalance(Math.floor(bet * (hits*1.5)));
                    gameActive=false; lock(false); 
                    // Clear selection for next game
                    kenoSel=[];
                }
            }, i*200);
        });
    }

    // --- LOOTBOX ---
    function openBox(type, cost) {
        if(gameActive) return;
        if(balance < cost) return notify("Brak ≈õrodk√≥w!");
        updateBalance(-cost); gameActive=true;
        
        const resDiv = document.getElementById('loot-res');
        resDiv.style.display='none';
        
        // Anim
        const card = document.querySelector(`.loot-card.${type}`);
        card.style.transform = "scale(0.9)";
        setTimeout(()=>{ card.style.transform = "scale(1)"; }, 150);

        setTimeout(() => {
            let win = 0;
            const r = Math.random();
            // Payout logic
            if(type==='bronze') win = r>0.5 ? 0 : (r>0.2 ? 200 : 1000);
            if(type==='silver') win = r>0.6 ? 0 : (r>0.3 ? 2000 : 10000);
            if(type==='gold') win = r>0.6 ? 10000 : (r>0.3 ? 30000 : 100000);
            if(type==='diamond') win = r>0.7 ? 50000 : (r>0.4 ? 200000 : 1000000);

            if(win > 0) { updateBalance(win); sfx.win(); resDiv.innerText=`+${fmt(win)} MC`; resDiv.style.color="var(--neon-success)"; }
            else { sfx.lose(); resDiv.innerText="PUSTO"; resDiv.style.color="var(--neon-danger)"; }
            
            resDiv.style.display='block';
            gameActive=false;
        }, 1000);
    }

    // --- LIMBO ---
    function playLimbo() {
        const bet = getBet(); if(!bet) return;
        updateBalance(-bet);
        const t = parseFloat(document.getElementById('limbo-t').value);
        const r = (Math.floor(90 / (Math.random() * 100) * 100) / 100) || 1.00;
        document.getElementById('limbo-res').innerText = r.toFixed(2)+'x';
        if(r>=t) { document.getElementById('limbo-res').style.color="var(--neon-success)"; updateBalance(Math.floor(bet*t)); sfx.win(); }
        else { document.getElementById('limbo-res').style.color="var(--neon-danger)"; sfx.lose(); }
    }

    // --- SHOP ---
    function renderShop(){ const g=document.getElementById('shop-grid'); g.innerHTML=''; shopItems.forEach(i=>{ g.innerHTML+=`<div class="game-card"><img src="${i.img}" style="width:100px;margin-bottom:10px;"><h3>${i.name}</h3><div style="color:var(--neon-accent)">${fmt(i.price)} MC</div><button class="btn-secondary" onclick="buy('${i.name}',${i.price})">KUP</button></div>`; }); }
    function buy(n,p){ if(balance<p)return notify("Brak kasy!", "error"); updateBalance(-p); notify("Kupiono!", "success"); confetti(); fetch(WEBHOOK, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({content:`üõí **ZAKUP:** ${n} (${userID})`})}); }

    // --- UTILS ---
    function updateBalance(a) { 
        balance += a; document.getElementById('balance').innerText = fmt(balance); localStorage.setItem('moon_balance', balance);
        if(a>0) { document.querySelector('.balance-card').classList.add('balance-update'); sfx.cash(); setTimeout(()=>document.querySelector('.balance-card').classList.remove('balance-update'), 500); }
    }
    function fmt(n) { return n.toLocaleString('en-US'); }
    function notify(m, t) { const n=document.getElementById('notify'); n.innerText=m; n.style.display='block'; n.style.background=t==='success'?'var(--neon-success)':'#fff'; setTimeout(()=>n.style.display='none',2000); }
    function getBet() { const b = parseInt(document.getElementById('bet-amount').value); if(!b || b<10 || b>balance) return 0; return b; }
    function lock(s) { 
        document.getElementById('bet-amount').disabled = s; 
        document.querySelectorAll('.bet-ctrl').forEach(b => b.disabled = s);
    }
    
    // --- ADMIN ---
    let ac=0; function openAdmin(){ document.getElementById('admin-modal').style.display='flex'; }
    function closeModal(id){ document.getElementById(id).style.display='none'; }
    function checkAdmin(){ if(document.getElementById('admin-pass').value===ADMIN_PASS) { document.getElementById('admin-tools').classList.remove('hidden'); } }
    function sendAnnounce(){ db.ref('system/announce').set({text:document.getElementById('announce-text').value, ts:Date.now()}); }
    function sendWipe(){ db.ref('system/wipe').push({target:document.getElementById('wipe-id').value, ts:Date.now()}); }
    function genCode(){ let c = `MOON-${document.getElementById('gen-amount').value}-${Math.random().toString(36).substr(2,4).toUpperCase()}`; document.getElementById('code-res').innerText=c; }
    function redeemCode(){ 
        const c = document.getElementById('redeem-code').value; 
        if(usedCodes.includes(c)) return notify("Kod u≈ºyty");
        if(c.startsWith('MOON-')) { updateBalance(parseInt(c.split('-')[1])); usedCodes.push(c); localStorage.setItem('moon_codes', JSON.stringify(usedCodes)); notify("KOD UTRAFIONY!"); closeModal('redeem-modal'); }
    }

    const sfx = {
        ctx: null, init(){if(!this.ctx)this.ctx=new(window.AudioContext)();},
        play(f,t,d){if(!this.ctx)return;const o=this.ctx.createOscillator(),g=this.ctx.createGain();o.type=t;o.frequency.value=f;g.gain.exponentialRampToValueAtTime(0.001,this.ctx.currentTime+d);o.connect(g);g.connect(this.ctx.destination);o.start();o.stop(this.ctx.currentTime+d);},
        win(){this.play(600,'sine',0.3);}, lose(){this.play(150,'sawtooth',0.5);}, cash(){this.play(1200,'square',0.1);}
    };
    const betUtils = {
        half(){ if(!gameActive) document.getElementById('bet-amount').value = Math.max(10, Math.floor(getBet()/2)); },
        double(){ if(!gameActive) document.getElementById('bet-amount').value = getBet()*2; },
        max(){ if(!gameActive) document.getElementById('bet-amount').value = balance; }
    };

    init();
</script>
</body>
</html>
